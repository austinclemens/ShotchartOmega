<!doctype html>
<html lang="en-US">
<head>
	<meta http-equiv="Content-Type" content="text/html;charset=utf-8">
	<link rel="stylesheet" type="text/css" media="all" href="css/bootstrap.min.css">
	<link rel="stylesheet" type="text/css" id="bsdp-css" href="css/datepicker3.css">
	<script src="http://code.jquery.com/jquery-2.1.1.min.js"></script>
	<script type="text/javascript" charset="utf-8" src="lib/bootstrap.min.js"></script>
	<script type="text/javascript" charset="utf-8" src="lib/bootstrap-datepicker.js"></script>
</head>

<script type="text/javascript">
$(document).ready(function(){
    $('[data-toggle="tooltip"]').tooltip();   
});

$(document).ready(function () {                
	$('#date1').datepicker({
		format: "mm/dd/yyyy",
		todayHighlight: true
	});  
});
</script>

<div class="container-fluid"><p></p>
<div role="tabpanel">

  <!-- Nav tabs -->
  <ul class="nav nav-tabs" role="tablist">
    <li role="presentation" class="active"><a href="#players" aria-controls="Players" role="tab" data-toggle="tab">Players</a></li>
	
    <li role="presentation"><a href="#playersadvanced" aria-controls="Players Advanced" role="tab" data-toggle="tab">Players - Advanced</a></li>
	
    <li role="presentation"><a href="#teams" aria-controls="Teams" role="tab" data-toggle="tab">Teams</a></li>
	
  </ul>

  <!-- Tab panes -->
  <div class="tab-content">
    <div role="tabpanel" class="tab-pane active" id="players">
		<h4>Choose a season and one player<br><small>Career charts will take more time to load.</small></h4>
		<p>
		<div class="row">
			<div class="col-xs-3">
				<select class="form-control" id="year_1">
					<option value='off'>Choose a season</option>
					<option value='2014'>2014-15</option>
					<option value='2013'>2013-14</option>
					<option value='2012'>2012-13</option>
					<option value='2011'>2011-12</option>
					<option value='2010'>2010-11</option>
					<option value='2009'>2009-10</option>
					<option value='2008'>2008-09</option>
					<option value='2007'>2007-08</option>
					<option value='2006'>2006-07</option>
					<option value='2005'>2005-06</option>
					<option value='2004'>2004-05</option>
					<option value='2003'>2003-04</option>
					<option value='2002'>2002-03</option>
					<option value='2001'>2001-02</option>
					<option value='2000'>2000-01</option>
					<option value='1999'>1999-00</option>
					<option value='1998'>1998-99</option>
					<option value='1997'>1997-98</option>					
					<option value='career'>Career</option>
				</select>
			</div>
			<div class="col-xs-3">
				<select class="form-control" id="season_1">
					<option>Regular season</option>
					<option>Playoffs</option>
				</select>
			</div>
		</div>
		</p>
		<p>
		<div class="row">
			<div class="col-xs-3">
				<select class="form-control" id="player" disabled>
					<option value='off'>Choose a player</option>
				</select>
			</div>
		</div>
		</p>
		<h4>Choose type of chart<br></h4>
		<p>
		<div class="row">
			<form class="form-inline" role="form">
				<div class="form-group">
					<div class="col-xs-3">
						<select class="form-control" id="efficiency_1">
							<option value='0'>Field goal %</option>
							<option value='1'>Efficiency (PPS)</option>
						</select>
					</div>
				</div>
				<div class="form-group">
					<span class="glyphicon glyphicon-question-sign" aria-hidden="true" style="font-size:1.3em" data-toggle="tooltip" data-placement="auto top" title="FG% charts compare the player's FG% at each location to league average FG% at that location. Efficiency charts compare the player's PPS at each location to league average PPS."></span>
				</div>
			</form>
		</div>
		</p>
		<br>
		<p>
		<button type="button" class="btn btn-success" id="run_1" onClick="update_1()" disabled>Run it</button> 
		<button type="button" class="btn btn-info" id="save_1" onClick="save()">Save to hard drive</button>
		</p>
	</div>
	
	
	
    <div role="tabpanel" class="tab-pane" id="playersadvanced">
	<p>
		<h4>Choose a season and up to 5 players<br><small>Hypothetical shot charts! Does not represent actual player pairings.</small></h4>
		<div class="row">
			<div class="col-xs-3">
				<select class="form-control" id="year_2">
					<option value='off'>Choose a season</option>
					<option value='2014'>2014-15</option>
					<option value='2013'>2013-14</option>
					<option value='2012'>2012-13</option>
					<option value='2011'>2011-12</option>
					<option value='2010'>2010-11</option>
					<option value='2009'>2009-10</option>
					<option value='2008'>2008-09</option>
					<option value='2007'>2007-08</option>
					<option value='2006'>2006-07</option>
					<option value='2005'>2005-06</option>
					<option value='2004'>2004-05</option>
					<option value='2003'>2003-04</option>
					<option value='2002'>2002-03</option>
					<option value='2001'>2001-02</option>
					<option value='2000'>2000-01</option>
					<option value='1999'>1999-00</option>
					<option value='1998'>1998-99</option>
					<option value='1997'>1997-98</option>					
				</select>
			</div>
			<div class="col-xs-3">
				<select class="form-control" id="season_2">
					<option>Regular season</option>
					<option>Playoffs</option>
				</select>
			</div>
			</p>
		</div>
		<div class="row">
			<p>
			<div class="col-xs-2">
				<select class="form-control" id="player1" disabled>
					<option value='off'>Choose a player</option>
				</select>
			</div>
			<div class="col-xs-2">
				<select class="form-control" id="player2" disabled>
					<option value='off'>Choose a player</option>
				</select>
			</div>
			<div class="col-xs-2">
				<select class="form-control" id="player3" disabled>
					<option value='off'>Choose a player</option>
				</select>
			</div>
		</p>
		</div>
		<div class="row">
			<p>
			<div class="col-xs-2">
				<select class="form-control" id="player4" disabled>
					<option value='off'>Choose a player</option>
				</select>
			</div>
			<div class="col-xs-2">
				<select class="form-control" id="player5" disabled>
					<option value='off'>Choose a player</option>
				</select>
			</div>
			</p>
		</div>
	</p>
	<p>
		<h4>Choose game period or date range (optional)<br></h4>
		<p>
		<div class="row">
			<div class="col-xs-3">
				<select class="form-control" id="quarter">
					<option value='off'>Complete game</option>
					<option value='1'>1st quarter</option>
					<option value='2'>2nd quarter</option>
					<option value='3'>3rd quarter</option>
					<option value='4'>4th quarter</option>
					<option value='4_minutes'>Last 4 minutes</option>
				</select>
			</div>
			<div class="col-xs-5">
				<div class="input-daterange input-group" id="date1">
    				<input type="text" class="input-sm form-control" id="startdate" />
    				<span class="input-group-addon">to</span>
    				<input type="text" class="input-sm form-control" id="enddate" />
				</div>
			</div>
		</div>
		</p>
		<h4>Choose type of chart<br></h4>
		<p>
		<div class="row">
			<form class="form-inline" role="form">
				<div class="form-group">
					<div class="col-xs-3">
						<select class="form-control" id="efficiency_2">
							<option value='0'>Field goal %</option>
							<option value='1'>Efficiency (PPS)</option>
						</select>
					</div>
				</div>
				<div class="form-group">
					<span class="glyphicon glyphicon-question-sign" aria-hidden="true" style="font-size:1.3em" data-toggle="tooltip" data-placement="auto top" title="FG% charts compare the player's FG% at each location to league average FG% at that location. Efficiency charts compare the player's PPS at each location to league average PPS."></span>
				</div>
			</form>
		</div>
		</p><br><p>
		<button type="button" class="btn btn-success" id="run_2" onClick="update_2()" disabled>Run it</button> 
		<button type="button" class="btn btn-info" id="save_2" onClick="save()">Save to hard drive</button>
	</p>
	</div>
    <div role="tabpanel" class="tab-pane" id="teams">
	<h4>Choose a season and a team<br><small>May take longer to load than other charts.</small></h4>
		<p>
		<div class="row">
			<div class="col-xs-3">
				<select class="form-control" id="year_3">
					<option value='off'>Choose a season</option>
					<option value='2014'>2014-15</option>
					<option value='2013'>2013-14</option>
					<option value='2012'>2012-13</option>
					<option value='2011'>2011-12</option>
					<option value='2010'>2010-11</option>
					<option value='2009'>2009-10</option>
					<option value='2008'>2008-09</option>
					<option value='2007'>2007-08</option>
					<option value='2006'>2006-07</option>
					<option value='2005'>2005-06</option>
					<option value='2004'>2004-05</option>
					<option value='2003'>2003-04</option>
					<option value='2002'>2002-03</option>
					<option value='2001'>2001-02</option>
					<option value='2000'>2000-01</option>
					<option value='1999'>1999-00</option>
					<option value='1998'>1998-99</option>
					<option value='1997'>1997-98</option>
				</select>
			</div>
			<div class="col-xs-3">
				<select class="form-control" id="season_3">
					<option>Regular season</option>
					<option>Playoffs</option>
				</select>
			</div>
		</div>
		</p>
		<p>
		<div class="row">
			<div class="col-xs-3">
				<select class="form-control" id="team_select" disabled>
					<option value='off'>Choose a team</option>
				</select>
			</div>
		</div>
		</p>
		<h4>Choose type of chart<br></h4>
		<p>
		<div class="row">
			<form class="form-inline" role="form">
				<div class="form-group">
					<div class="col-xs-3">
						<select class="form-control" id="team_type">
							<option value='1'>Offense</option>
							<option value='0'>Defense</option>
						</select>
					</div>
				</div>
				<div class="form-group">
					<div class="col-xs-3">
						<select class="form-control" id="efficiency_3" >
							<option value='0'>Field goal %</option>
							<option value='1'>Efficiency (PPS)</option>
						</select>
					</div>
				</div>
				<div class="form-group">
					<span class="glyphicon glyphicon-question-sign" aria-hidden="true" style="font-size:1.3em" data-toggle="tooltip" data-placement="auto top" title="FG% charts compare the player's FG% at each location to league average FG% at that location. Efficiency charts compare the player's PPS at each location to league average PPS."></span>
				</div>
			</form>
		</div>
		</p>
		<br>
		<p>
		<button type="button" class="btn btn-success" id="run_3" onClick="update_3()" disabled>Run it</button> 
		<button type="button" class="btn btn-info" id="save_3" onClick="save()">Save to hard drive</button>
		</p>
	</div>
	<div class="iframeWrapper" style="position: relative; padding-bottom: 74.25%; padding-top: 25px; height: 0;">
<iframe id="shotchart" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%;" src="canvas_shot_fabric_o.html?player1=Dirk Nowitzki&year=2013&efficiency=FG&season=Regular season&chart_type=1" frameborder="0" align="middle" width=900 height=660 seamless="seamless" scrolling="no" class="aligncenter"></iframe></div>

</div></div>

<script>
// Update player and team fields according to year entry
// var e = document.getElementById("year_1");
// var z_year = e.options[e.selectedIndex].value;
// $("#player_select").load("place_years/" + z_year + ".txt");

$("#year_1").change(function() {
    var e = document.getElementById("year_1");
    var u_year = e.options[e.selectedIndex].value;

    if (u_year=='off') { 
    	$('#player').prop('disabled',true);
    	$('#run_1').prop('disabled',true)
    }

	if (u_year!='off') { 
		$('#player').prop('disabled',false)
		y_update=[]
		y_update.push({year:u_year,pl:1})
		load_playermenu(y_update[0])
	}
});

$("#year_2").change(function() {
    var e = document.getElementById("year_2");
    var u_year = e.options[e.selectedIndex].value;

    if (u_year=='off') {
    	$('#player1').prop('disabled',true);
    	$('#player2').prop('disabled',true);
    	$('#player3').prop('disabled',true);
    	$('#player4').prop('disabled',true);
    	$('#player5').prop('disabled',true);
    	$('#run_2').prop('disabled',true)
    }

    if (u_year!='off') {
    	$('#player1').prop('disabled',false)
    	y_update=[]
		y_update.push({year:u_year,pl:1})
		load_playermenu(y_update[0])
    }
});

$("#year_3").change(function() {
    var e = document.getElementById("year_3");
    var u_year = e.options[e.selectedIndex].value;

    if (u_year=='off') {
		$('#team_select').prop('disabled',true);
		$('#run_3').prop('disabled',true)
    }

    if (u_year!='off') {
    	$('#team_select').prop('disabled',false)
    	y_update=[]
		y_update.push({year:u_year,pl:0})
		load_teammenu(y_update[0])	
    }
});

// Function to call update_players.py and get list for dropdown
function load_playermenu(y_update) {
	$.ajax({
	url: "http://www.austinclemens.com/cgi-bin/update_players.py",
	type: "post",
	datatype: "html",
	data: y_update,
	success: function(response){
		var menu_data = eval("(" + response + ")");
		var select=document.getElementById('player');
		$("#player").empty()
		var el=document.createElement("option")
		el.textContent='Choose a player'
		el.value='off'
		select.appendChild(el)
		for (var i=1; i<menu_data.length;i++) {
			var opt=menu_data[i]
			var el=document.createElement("option");
			el.textContent=opt;
			el.value=opt;
			select.appendChild(el)
		}

		var p1=document.getElementById('player1')
		var p2=document.getElementById('player2')
		var p3=document.getElementById('player3')
		var p4=document.getElementById('player4')
		var p5=document.getElementById('player5')

		var options=select.innerHTML;

		p1.innerHTML=options
		p2.innerHTML=options
		p3.innerHTML=options
		p4.innerHTML=options
		p5.innerHTML=options
	}
	});
}

function load_teammenu(y_update) {
	$.ajax({
	url: "http://www.austinclemens.com/cgi-bin/update_players.py",
	type: "post",
	datatype: "html",
	data: y_update,
	success: function(response){
		var menu_data = eval("(" + response + ")");
		var select=document.getElementById('team_select');
		$("#team_select").empty()
		var el=document.createElement("option")
		el.textContent='Choose a team'
		el.value='off'
		for (var i=0; i<menu_data.length;i++) {
			var opt=menu_data[i]
			var el=document.createElement("option");
			el.textContent=opt;
			el.value=opt;
			select.appendChild(el)
		}
	}
	});
}

// update functions - one for each tab, initiate redraw inside the iframe by calling load_pshotnew.
function update_1() {
    var e = document.getElementById("year_1");
    var u_year = e.options[e.selectedIndex].value;

    var e = document.getElementById("player");
    var u_player = e.options[e.selectedIndex].value;

    var e = document.getElementById("efficiency_1");
    var u_efficient = e.options[e.selectedIndex].value;

    var e = document.getElementById("season_1");
    var u_season = e.options[e.selectedIndex].value;

    var dict=[]
    dict.push({chart_type:'1',player1:u_player,year:u_year,efficiency:u_efficient,season:u_season})

    document.getElementById('shotchart').contentWindow.load_pshotnew(dict[0])
}

function update_2() {
    var e = document.getElementById("year_2");
    var u_year = e.options[e.selectedIndex].value;

    var e = document.getElementById("player1");
    var u_player1 = e.options[e.selectedIndex].value;

    var e = document.getElementById("player2");
    var u_player2 = e.options[e.selectedIndex].value;

    var e = document.getElementById("player3");
    var u_player3 = e.options[e.selectedIndex].value;

    var e = document.getElementById("player4");
    var u_player4 = e.options[e.selectedIndex].value;

    var e = document.getElementById("player5");
    var u_player5 = e.options[e.selectedIndex].value;

    var e = document.getElementById("efficiency_2");
    var u_efficient = e.options[e.selectedIndex].value;

    var e = document.getElementById("season_2");
    var u_season = e.options[e.selectedIndex].value;

    var e = document.getElementById("quarter");
    var u_quarter = e.options[e.selectedIndex].value;

    var u_startdate='off'
    var u_enddate='off'

    // var e = document.getElementById("startdate");
    // var u_startdate = e.options[e.selectedIndex].value;

    // var e = document.getElementById("enddate");
    // var u_enddate = e.options[e.selectedIndex].value;

    var dict=[]
    dict.push({chart_type:'2',player1:u_player1,year:u_year,efficiency:u_efficient,season:u_season,player2:u_player2,player3:u_player3,player4:u_player4,player5:u_player5,quarter:u_quarter,startdate:u_startdate,enddate:u_enddate})

    document.getElementById('shotchart').contentWindow.load_pshotnew(dict[0])
}

function update_3() {
    var e = document.getElementById("year_3");
    var u_year = e.options[e.selectedIndex].value;

    var e = document.getElementById("team_select");
    var u_team = e.options[e.selectedIndex].value;

    var e = document.getElementById("efficiency_3");
    var u_efficient = e.options[e.selectedIndex].value;

    var e = document.getElementById("season_3");
    var u_season = e.options[e.selectedIndex].value;

    var e = document.getElementById("team_type");
    var u_teamtype = e.options[e.selectedIndex].value;

    var dict=[]
    dict.push({chart_type:'3',team:u_team,year:u_year,efficiency:u_efficient,season:u_season,defense_offense:u_teamtype})

    document.getElementById('shotchart').contentWindow.load_pshotnew(dict[0])
}

// Save to png function
function save() {  
    var stage = document.getElementById("shotchart").contentWindow.stage;
    stage.toDataURL({
        callback: function(dataUrl) {
            window.open(dataUrl)
        },
    })
}

// Form disabling logic
$("#player").change(function() {
    var e = document.getElementById("player");
    var u_player = e.options[e.selectedIndex].value;

    if (u_player=='off') { 
    	$('#run_1').prop('disabled',true)
    }

	if (u_player!='off') { 
    	$('#run_1').prop('disabled',false)
	}
});

$("#team_select").change(function() {
    var e = document.getElementById("team_select");
    var u_team = e.options[e.selectedIndex].value;

    if (u_team=='off') { 
    	$('#run_3').prop('disabled',true)
    }

	if (u_team!='off') { 
    	$('#run_3').prop('disabled',false)
	}
});

$("#player1").change(function() {
    var e = document.getElementById("player1");
    var u_player = e.options[e.selectedIndex].value;

    if (u_player=='off') { 
    	$('#run_2').prop('disabled',true)
       	$('#player2').prop('disabled',true)
       	$('#player3').prop('disabled',true)
       	$('#player4').prop('disabled',true)
       	$('#player5').prop('disabled',true)
       	$("#player2").val('off');
       	$("#player3").val('off');
       	$("#player4").val('off');
       	$("#player5").val('off');

    }

	if (u_player!='off') { 
    	$('#run_2').prop('disabled',false)
    	$('#player2').prop('disabled',false)
	}
});

$("#player2").change(function() {
    var e = document.getElementById("player2");
    var u_player = e.options[e.selectedIndex].value;

    if (u_player=='off') { 
       	$('#player3').prop('disabled',true)
       	$('#player4').prop('disabled',true)
       	$('#player5').prop('disabled',true)
       	$("#player3").val('off');
       	$("#player4").val('off');
       	$("#player5").val('off');

    }

	if (u_player!='off') { 
    	$('#player3').prop('disabled',false)
	}
});

$("#player3").change(function() {
    var e = document.getElementById("player3");
    var u_player = e.options[e.selectedIndex].value;

    if (u_player=='off') { 
       	$('#player4').prop('disabled',true)
       	$('#player5').prop('disabled',true)
       	$("#player4").val('off');
       	$("#player5").val('off');

    }

	if (u_player!='off') { 
    	$('#player4').prop('disabled',false)
	}
});

$("#player3").change(function() {
    var e = document.getElementById("player3");
    var u_player = e.options[e.selectedIndex].value;

    if (u_player=='off') { 
       	$('#player4').prop('disabled',true)
       	$('#player5').prop('disabled',true)
       	$("#player4").val('off');
       	$("#player5").val('off');

    }

	if (u_player!='off') { 
    	$('#player4').prop('disabled',false)
	}
});

$("#player4").change(function() {
    var e = document.getElementById("player4");
    var u_player = e.options[e.selectedIndex].value;

    if (u_player=='off') { 
       	$('#player5').prop('disabled',true)
       	$("#player5").val('off');

    }

	if (u_player!='off') { 
    	$('#player5').prop('disabled',false)
	}
});

</script>
