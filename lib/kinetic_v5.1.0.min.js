var Kinetic={};(function(e){var t=Math.PI/180;Kinetic={version:"5.1.0",stages:[],idCounter:0,ids:{},names:{},shapes:{},listenClickTap:false,inDblClickWindow:false,enableTrace:false,traceArrMax:100,dblClickWindow:400,pixelRatio:undefined,dragDistance:0,angleDeg:true,UA:function(){var t=e.navigator&&e.navigator.userAgent||"";var n=t.toLowerCase(),r=/(chrome)[ \/]([\w.]+)/.exec(n)||/(webkit)[ \/]([\w.]+)/.exec(n)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(n)||/(msie) ([\w.]+)/.exec(n)||n.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(n)||[],i=!!t.match(/Android|BlackBerry|iPhone|iPad|iPod|Opera Mini|IEMobile/i);return{browser:r[1]||"",version:r[2]||"0",mobile:i}}(),Filters:{},Node:function(e){this._init(e)},Shape:function(e){this.__init(e)},Container:function(e){this.__init(e)},Stage:function(e){this.___init(e)},BaseLayer:function(e){this.___init(e)},Layer:function(e){this.____init(e)},FastLayer:function(e){this.____init(e)},Group:function(e){this.___init(e)},isDragging:function(){var e=Kinetic.DD;if(!e){return false}else{return e.isDragging}},isDragReady:function(){var e=Kinetic.DD;if(!e){return false}else{return!!e.node}},_addId:function(e,t){if(t!==undefined){this.ids[t]=e}},_removeId:function(e){if(e!==undefined){delete this.ids[e]}},_addName:function(e,t){if(t!==undefined){if(this.names[t]===undefined){this.names[t]=[]}this.names[t].push(e)}},_removeName:function(e,t){if(e!==undefined){var n=this.names[e];if(n!==undefined){for(var r=0;r<n.length;r++){var i=n[r];if(i._id===t){n.splice(r,1)}}if(n.length===0){delete this.names[e]}}}},getAngle:function(e){return this.angleDeg?e*t:e}}})(this);(function(e,t){if(typeof exports==="object"){var n=require("canvas");var r=require("jsdom").jsdom;var i=r("<!DOCTYPE html><html><head></head><body></body></html>");var s=t();Kinetic.document=i;Kinetic.window=Kinetic.document.createWindow();Kinetic.window.Image=n.Image;Kinetic.root=e;Kinetic._nodeCanvas=n;module.exports=s;return}else if(typeof define==="function"&&define.amd){define(t)}Kinetic.document=document;Kinetic.window=window;Kinetic.root=e})((1,eval)("this"),function(){return Kinetic});(function(){Kinetic.Collection=function(){var e=[].slice.call(arguments),t=e.length,n=0;this.length=t;for(;n<t;n++){this[n]=e[n]}return this};Kinetic.Collection.prototype=[];Kinetic.Collection.prototype.each=function(e){for(var t=0;t<this.length;t++){e(this[t],t)}};Kinetic.Collection.prototype.toArray=function(){var e=[],t=this.length,n;for(n=0;n<t;n++){e.push(this[n])}return e};Kinetic.Collection.toCollection=function(e){var t=new Kinetic.Collection,n=e.length,r;for(r=0;r<n;r++){t.push(e[r])}return t};Kinetic.Collection._mapMethod=function(e){Kinetic.Collection.prototype[e]=function(){var t=this.length,n;var r=[].slice.call(arguments);for(n=0;n<t;n++){this[n][e].apply(this[n],r)}return this}};Kinetic.Collection.mapMethods=function(e){var t=e.prototype;for(var n in t){Kinetic.Collection._mapMethod(n)}};Kinetic.Transform=function(e){this.m=e&&e.slice()||[1,0,0,1,0,0]};Kinetic.Transform.prototype={copy:function(){return new Kinetic.Transform(this.m)},point:function(e){var t=this.m;return{x:t[0]*e.x+t[2]*e.y+t[4],y:t[1]*e.x+t[3]*e.y+t[5]}},translate:function(e,t){this.m[4]+=this.m[0]*e+this.m[2]*t;this.m[5]+=this.m[1]*e+this.m[3]*t;return this},scale:function(e,t){this.m[0]*=e;this.m[1]*=e;this.m[2]*=t;this.m[3]*=t;return this},rotate:function(e){var t=Math.cos(e);var n=Math.sin(e);var r=this.m[0]*t+this.m[2]*n;var i=this.m[1]*t+this.m[3]*n;var s=this.m[0]*-n+this.m[2]*t;var o=this.m[1]*-n+this.m[3]*t;this.m[0]=r;this.m[1]=i;this.m[2]=s;this.m[3]=o;return this},getTranslation:function(){return{x:this.m[4],y:this.m[5]}},skew:function(e,t){var n=this.m[0]+this.m[2]*t;var r=this.m[1]+this.m[3]*t;var i=this.m[2]+this.m[0]*e;var s=this.m[3]+this.m[1]*e;this.m[0]=n;this.m[1]=r;this.m[2]=i;this.m[3]=s;return this},multiply:function(e){var t=this.m[0]*e.m[0]+this.m[2]*e.m[1];var n=this.m[1]*e.m[0]+this.m[3]*e.m[1];var r=this.m[0]*e.m[2]+this.m[2]*e.m[3];var i=this.m[1]*e.m[2]+this.m[3]*e.m[3];var s=this.m[0]*e.m[4]+this.m[2]*e.m[5]+this.m[4];var o=this.m[1]*e.m[4]+this.m[3]*e.m[5]+this.m[5];this.m[0]=t;this.m[1]=n;this.m[2]=r;this.m[3]=i;this.m[4]=s;this.m[5]=o;return this},invert:function(){var e=1/(this.m[0]*this.m[3]-this.m[1]*this.m[2]);var t=this.m[3]*e;var n=-this.m[1]*e;var r=-this.m[2]*e;var i=this.m[0]*e;var s=e*(this.m[2]*this.m[5]-this.m[3]*this.m[4]);var o=e*(this.m[1]*this.m[4]-this.m[0]*this.m[5]);this.m[0]=t;this.m[1]=n;this.m[2]=r;this.m[3]=i;this.m[4]=s;this.m[5]=o;return this},getMatrix:function(){return this.m},setAbsolutePosition:function(e,t){var n=this.m[0],r=this.m[1],i=this.m[2],s=this.m[3],o=this.m[4],u=this.m[5],a=(n*(t-u)-r*(e-o))/(n*s-r*i),f=(e-o-i*a)/n;return this.translate(f,a)}};var e="canvas",t="2d",n="[object Array]",r="[object Number]",i="[object String]",s=Math.PI/180,o=180/Math.PI,u="#",a="",f="0",l="Kinetic warning: ",c="Kinetic error: ",h="rgb(",p={aqua:[0,255,255],lime:[0,255,0],silver:[192,192,192],black:[0,0,0],maroon:[128,0,0],teal:[0,128,128],blue:[0,0,255],navy:[0,0,128],white:[255,255,255],fuchsia:[255,0,255],olive:[128,128,0],yellow:[255,255,0],orange:[255,165,0],gray:[128,128,128],purple:[128,0,128],green:[0,128,0],red:[255,0,0],pink:[255,192,203],cyan:[0,255,255],transparent:[255,255,255,0]},d=/rgb\((\d{1,3}),(\d{1,3}),(\d{1,3})\)/;Kinetic.Util={_isElement:function(e){return!!(e&&e.nodeType==1)},_isFunction:function(e){return!!(e&&e.constructor&&e.call&&e.apply)},_isObject:function(e){return!!e&&e.constructor==Object},_isArray:function(e){return Object.prototype.toString.call(e)==n},_isNumber:function(e){return Object.prototype.toString.call(e)==r},_isString:function(e){return Object.prototype.toString.call(e)==i},_throttle:function(e,t,n){var r,i,s;var o=null;var u=0;n||(n={});var a=function(){u=n.leading===false?0:(new Date).getTime();o=null;s=e.apply(r,i);r=i=null};return function(){var f=(new Date).getTime();if(!u&&n.leading===false)u=f;var l=t-(f-u);r=this;i=arguments;if(l<=0){clearTimeout(o);o=null;u=f;s=e.apply(r,i);r=i=null}else if(!o&&n.trailing!==false){o=setTimeout(a,l)}return s}},_hasMethods:function(e){var t=[],n;for(n in e){if(this._isFunction(e[n])){t.push(n)}}return t.length>0},createCanvasElement:function(){var e=Kinetic.document.createElement("canvas");e.style=e.style||{};return e},isBrowser:function(){return typeof exports!=="object"},_isInDocument:function(e){while(e=e.parentNode){if(e==Kinetic.document){return true}}return false},_simplifyArray:function(e){var t=[],n=e.length,r=Kinetic.Util,i,s;for(i=0;i<n;i++){s=e[i];if(r._isNumber(s)){s=Math.round(s*1e3)/1e3}else if(!r._isString(s)){s=s.toString()}t.push(s)}return t},_getImage:function(e,n){var r,i;if(!e){n(null)}else if(this._isElement(e)){n(e)}else if(this._isString(e)){r=new Kinetic.window.Image;r.onload=function(){n(r)};r.src=e}else if(e.data){i=Kinetic.Util.createCanvasElement();i.width=e.width;i.height=e.height;var s=i.getContext(t);s.putImageData(e,0,0);this._getImage(i.toDataURL(),n)}else{n(null)}},_getRGBAString:function(e){var t=e.red||0,n=e.green||0,r=e.blue||0,i=e.alpha||1;return["rgba(",t,",",n,",",r,",",i,")"].join(a)},_rgbToHex:function(e,t,n){return((1<<24)+(e<<16)+(t<<8)+n).toString(16).slice(1)},_hexToRgb:function(e){e=e.replace(u,a);var t=parseInt(e,16);return{r:t>>16&255,g:t>>8&255,b:t&255}},getRandomColor:function(){var e=(Math.random()*16777215<<0).toString(16);while(e.length<6){e=f+e}return u+e},get:function(e,t){if(e===undefined){return t}else{return e}},getRGB:function(e){var t;if(e in p){t=p[e];return{r:t[0],g:t[1],b:t[2]}}else if(e[0]===u){return this._hexToRgb(e.substring(1))}else if(e.substr(0,4)===h){t=d.exec(e.replace(/ /g,""));return{r:parseInt(t[1],10),g:parseInt(t[2],10),b:parseInt(t[3],10)}}else{return{r:0,g:0,b:0}}},_merge:function(e,t){var n=this._clone(t);for(var r in e){if(this._isObject(e[r])){n[r]=this._merge(e[r],n[r])}else{n[r]=e[r]}}return n},cloneObject:function(e){var t={};for(var n in e){if(this._isObject(e[n])){t[n]=this.cloneObject(e[n])}else if(this._isArray(e[n])){t[n]=this.cloneArray(e[n])}else{t[n]=e[n]}}return t},cloneArray:function(e){return e.slice(0)},_degToRad:function(e){return e*s},_radToDeg:function(e){return e*o},_capitalize:function(e){return e.charAt(0).toUpperCase()+e.slice(1)},error:function(e){throw new Error(c+e)},warn:function(e){if(Kinetic.root.console&&console.warn){console.warn(l+e)}},extend:function(e,t){for(var n in t.prototype){if(!(n in e.prototype)){e.prototype[n]=t.prototype[n]}}},addMethods:function(e,t){var n;for(n in t){e.prototype[n]=t[n]}},_getControlPoints:function(e,t,n,r,i,s,o){var u=Math.sqrt(Math.pow(n-e,2)+Math.pow(r-t,2)),a=Math.sqrt(Math.pow(i-n,2)+Math.pow(s-r,2)),f=o*u/(u+a),l=o*a/(u+a),c=n-f*(i-e),h=r-f*(s-t),p=n+l*(i-e),d=r+l*(s-t);return[c,h,p,d]},_expandPoints:function(e,t){var n=e.length,r=[],i,s;for(i=2;i<n-2;i+=2){s=Kinetic.Util._getControlPoints(e[i-2],e[i-1],e[i],e[i+1],e[i+2],e[i+3],t);r.push(s[0]);r.push(s[1]);r.push(e[i]);r.push(e[i+1]);r.push(s[2]);r.push(s[3])}return r},_removeLastLetter:function(e){return e.substring(0,e.length-1)}}})();(function(){var e=Kinetic.Util.createCanvasElement(),t=e.getContext("2d"),n=Kinetic.UA.mobile?function(){var e=window.devicePixelRatio||1,n=t.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||t.backingStorePixelRatio||1;return e/n}():window.devicePixelRatio;Kinetic.Canvas=function(e){this.init(e)};Kinetic.Canvas.prototype={init:function(e){e=e||{};var t=e.pixelRatio||Kinetic.pixelRatio||n;this.pixelRatio=t;this._canvas=Kinetic.Util.createCanvasElement();this._canvas.style.padding=0;this._canvas.style.margin=0;this._canvas.style.border=0;this._canvas.style.background="transparent";this._canvas.style.position="absolute";this._canvas.style.top=0;this._canvas.style.left=0},getContext:function(){return this.context},getPixelRatio:function(){return this.pixelRatio},setPixelRatio:function(e){this.pixelRatio=e;this.setSize(this.getWidth(),this.getHeight())},setWidth:function(e){this.width=this._canvas.width=e*this.pixelRatio;this._canvas.style.width=e+"px"},setHeight:function(e){this.height=this._canvas.height=e*this.pixelRatio;this._canvas.style.height=e+"px"},getWidth:function(){return this.width},getHeight:function(){return this.height},setSize:function(e,t){this.setWidth(e);this.setHeight(t)},toDataURL:function(e,t){try{return this._canvas.toDataURL(e,t)}catch(n){try{return this._canvas.toDataURL()}catch(r){Kinetic.Util.warn("Unable to get data URL. "+r.message);return""}}}};Kinetic.SceneCanvas=function(e){e=e||{};var t=e.width||0,n=e.height||0;Kinetic.Canvas.call(this,e);this.context=new Kinetic.SceneContext(this);this.setSize(t,n)};Kinetic.SceneCanvas.prototype={setWidth:function(e){var t=this.pixelRatio,n=this.getContext()._context;Kinetic.Canvas.prototype.setWidth.call(this,e);n.scale(t,t)},setHeight:function(e){var t=this.pixelRatio,n=this.getContext()._context;Kinetic.Canvas.prototype.setHeight.call(this,e);n.scale(t,t)}};Kinetic.Util.extend(Kinetic.SceneCanvas,Kinetic.Canvas);Kinetic.HitCanvas=function(e){e=e||{};var t=e.width||0,n=e.height||0;Kinetic.Canvas.call(this,e);this.context=new Kinetic.HitContext(this);this.setSize(t,n)};Kinetic.Util.extend(Kinetic.HitCanvas,Kinetic.Canvas)})();(function(){var e=",",t="(",n=")",r="([",i="])",s=";",o="()",u="=",a=["arc","arcTo","beginPath","bezierCurveTo","clearRect","clip","closePath","createLinearGradient","createPattern","createRadialGradient","drawImage","fill","fillText","getImageData","createImageData","lineTo","moveTo","putImageData","quadraticCurveTo","rect","restore","rotate","save","scale","setLineDash","setTransform","stroke","strokeText","transform","translate"];Kinetic.Context=function(e){this.init(e)};Kinetic.Context.prototype={init:function(e){this.canvas=e;this._context=e._canvas.getContext("2d");if(Kinetic.enableTrace){this.traceArr=[];this._enableTrace()}},fillShape:function(e){if(e.getFillEnabled()){this._fill(e)}},strokeShape:function(e){if(e.getStrokeEnabled()){this._stroke(e)}},fillStrokeShape:function(e){var t=e.getFillEnabled();if(t){this._fill(e)}if(e.getStrokeEnabled()){this._stroke(e)}},getTrace:function(a){var f=this.traceArr,l=f.length,c="",h,p,d,v;for(h=0;h<l;h++){p=f[h];d=p.method;if(d){v=p.args;c+=d;if(a){c+=o}else{if(Kinetic.Util._isArray(v[0])){c+=r+v.join(e)+i}else{c+=t+v.join(e)+n}}}else{c+=p.property;if(!a){c+=u+p.val}}c+=s}return c},clearTrace:function(){this.traceArr=[]},_trace:function(e){var t=this.traceArr,n;t.push(e);n=t.length;if(n>=Kinetic.traceArrMax){t.shift()}},reset:function(){var e=this.getCanvas().getPixelRatio();this.setTransform(1*e,0,0,1*e,0,0)},getCanvas:function(){return this.canvas},clear:function(e){var t=this.getCanvas();if(e){this.clearRect(e.x||0,e.y||0,e.width||0,e.height||0)}else{this.clearRect(0,0,t.getWidth(),t.getHeight())}},_applyLineCap:function(e){var t=e.getLineCap();if(t){this.setAttr("lineCap",t)}},_applyOpacity:function(e){var t=e.getAbsoluteOpacity();if(t!==1){this.setAttr("globalAlpha",t)}},_applyLineJoin:function(e){var t=e.getLineJoin();if(t){this.setAttr("lineJoin",t)}},setAttr:function(e,t){this._context[e]=t},arc:function(){var e=arguments;this._context.arc(e[0],e[1],e[2],e[3],e[4],e[5])},beginPath:function(){this._context.beginPath()},bezierCurveTo:function(){var e=arguments;this._context.bezierCurveTo(e[0],e[1],e[2],e[3],e[4],e[5])},clearRect:function(){var e=arguments;this._context.clearRect(e[0],e[1],e[2],e[3])},clip:function(){this._context.clip()},closePath:function(){this._context.closePath()},createImageData:function(){var e=arguments;if(e.length===2){return this._context.createImageData(e[0],e[1])}else if(e.length===1){return this._context.createImageData(e[0])}},createLinearGradient:function(){var e=arguments;return this._context.createLinearGradient(e[0],e[1],e[2],e[3])},createPattern:function(){var e=arguments;return this._context.createPattern(e[0],e[1])},createRadialGradient:function(){var e=arguments;return this._context.createRadialGradient(e[0],e[1],e[2],e[3],e[4],e[5])},drawImage:function(){var e=arguments,t=this._context;if(e.length===3){t.drawImage(e[0],e[1],e[2])}else if(e.length===5){t.drawImage(e[0],e[1],e[2],e[3],e[4])}else if(e.length===9){t.drawImage(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8])}},fill:function(){this._context.fill()},fillText:function(){var e=arguments;this._context.fillText(e[0],e[1],e[2])},getImageData:function(){var e=arguments;return this._context.getImageData(e[0],e[1],e[2],e[3])},lineTo:function(){var e=arguments;this._context.lineTo(e[0],e[1])},moveTo:function(){var e=arguments;this._context.moveTo(e[0],e[1])},rect:function(){var e=arguments;this._context.rect(e[0],e[1],e[2],e[3])},putImageData:function(){var e=arguments;this._context.putImageData(e[0],e[1],e[2])},quadraticCurveTo:function(){var e=arguments;this._context.quadraticCurveTo(e[0],e[1],e[2],e[3])},restore:function(){this._context.restore()},rotate:function(){var e=arguments;this._context.rotate(e[0])},save:function(){this._context.save()},scale:function(){var e=arguments;this._context.scale(e[0],e[1])},setLineDash:function(){var e=arguments,t=this._context;if(this._context.setLineDash){t.setLineDash(e[0])}else if("mozDash"in t){t.mozDash=e[0]}else if("webkitLineDash"in t){t.webkitLineDash=e[0]}},setTransform:function(){var e=arguments;this._context.setTransform(e[0],e[1],e[2],e[3],e[4],e[5])},stroke:function(){this._context.stroke()},strokeText:function(){var e=arguments;this._context.strokeText(e[0],e[1],e[2])},transform:function(){var e=arguments;this._context.transform(e[0],e[1],e[2],e[3],e[4],e[5])},translate:function(){var e=arguments;this._context.translate(e[0],e[1])},_enableTrace:function(){var e=this,t=a.length,n=Kinetic.Util._simplifyArray,r=this.setAttr,i,s;var o=function(t){var r=e[t],i;e[t]=function(){s=n(Array.prototype.slice.call(arguments,0));i=r.apply(e,arguments);e._trace({method:t,args:s});return i}};for(i=0;i<t;i++){o(a[i])}e.setAttr=function(){r.apply(e,arguments);e._trace({property:arguments[0],val:arguments[1]})}}};Kinetic.SceneContext=function(e){Kinetic.Context.call(this,e)};Kinetic.SceneContext.prototype={_fillColor:function(e){var t=e.fill()||Kinetic.Util._getRGBAString({red:e.fillRed(),green:e.fillGreen(),blue:e.fillBlue(),alpha:e.fillAlpha()});this.setAttr("fillStyle",t);e._fillFunc(this)},_fillPattern:function(e){var t=e.getFillPatternImage(),n=e.getFillPatternX(),r=e.getFillPatternY(),i=e.getFillPatternScale(),s=Kinetic.getAngle(e.getFillPatternRotation()),o=e.getFillPatternOffset(),u=e.getFillPatternRepeat();if(n||r){this.translate(n||0,r||0)}if(s){this.rotate(s)}if(i){this.scale(i.x,i.y)}if(o){this.translate(-1*o.x,-1*o.y)}this.setAttr("fillStyle",this.createPattern(t,u||"repeat"));this.fill()},_fillLinearGradient:function(e){var t=e.getFillLinearGradientStartPoint(),n=e.getFillLinearGradientEndPoint(),r=e.getFillLinearGradientColorStops(),i=this.createLinearGradient(t.x,t.y,n.x,n.y);if(r){for(var s=0;s<r.length;s+=2){i.addColorStop(r[s],r[s+1])}this.setAttr("fillStyle",i);this.fill()}},_fillRadialGradient:function(e){var t=e.getFillRadialGradientStartPoint(),n=e.getFillRadialGradientEndPoint(),r=e.getFillRadialGradientStartRadius(),i=e.getFillRadialGradientEndRadius(),s=e.getFillRadialGradientColorStops(),o=this.createRadialGradient(t.x,t.y,r,n.x,n.y,i);for(var u=0;u<s.length;u+=2){o.addColorStop(s[u],s[u+1])}this.setAttr("fillStyle",o);this.fill()},_fill:function(e){var t=e.fill()||e.fillRed()||e.fillGreen()||e.fillBlue(),n=e.getFillPatternImage(),r=e.getFillLinearGradientColorStops(),i=e.getFillRadialGradientColorStops(),s=e.getFillPriority();if(t&&s==="color"){this._fillColor(e)}else if(n&&s==="pattern"){this._fillPattern(e)}else if(r&&s==="linear-gradient"){this._fillLinearGradient(e)}else if(i&&s==="radial-gradient"){this._fillRadialGradient(e)}else if(t){this._fillColor(e)}else if(n){this._fillPattern(e)}else if(r){this._fillLinearGradient(e)}else if(i){this._fillRadialGradient(e)}},_stroke:function(e){var t=e.dash(),n=e.getStrokeScaleEnabled();if(e.hasStroke()){if(!n){this.save();this.setTransform(1,0,0,1,0,0)}this._applyLineCap(e);if(t&&e.dashEnabled()){this.setLineDash(t)}this.setAttr("lineWidth",e.strokeWidth());this.setAttr("strokeStyle",e.stroke()||Kinetic.Util._getRGBAString({red:e.strokeRed(),green:e.strokeGreen(),blue:e.strokeBlue(),alpha:e.strokeAlpha()}));e._strokeFunc(this);if(!n){this.restore()}}},_applyShadow:function(e){var t=Kinetic.Util,n=e.getAbsoluteOpacity(),r=t.get(e.getShadowColor(),"black"),i=t.get(e.getShadowBlur(),5),s=t.get(e.getShadowOpacity(),1),o=t.get(e.getShadowOffset(),{x:0,y:0});if(s){this.setAttr("globalAlpha",s*n)}this.setAttr("shadowColor",r);this.setAttr("shadowBlur",i);this.setAttr("shadowOffsetX",o.x);this.setAttr("shadowOffsetY",o.y)}};Kinetic.Util.extend(Kinetic.SceneContext,Kinetic.Context);Kinetic.HitContext=function(e){Kinetic.Context.call(this,e)};Kinetic.HitContext.prototype={_fill:function(e){this.save();this.setAttr("fillStyle",e.colorKey);e._fillFuncHit(this);this.restore()},_stroke:function(e){if(e.hasStroke()){this._applyLineCap(e);this.setAttr("lineWidth",e.strokeWidth());this.setAttr("strokeStyle",e.colorKey);e._strokeFuncHit(this)}}};Kinetic.Util.extend(Kinetic.HitContext,Kinetic.Context)})();(function(){var e="absoluteOpacity",t="absoluteTransform",n="add",r="b",i="before",s="black",o="Change",u="children",a="Deg",f=".",l="",c="g",h="get",p="#",d="id",v="kinetic",m="listening",g="mouseenter",y="mouseleave",b="name",w="off",E="on",S="_get",x="r",T="RGB",N="set",C="Shape",k=" ",L="Stage",A="transform",O="B",M="G",_="Height",D="R",P="Width",H="X",B="Y",j="visible",F="x",I="y";Kinetic.Factory={addGetterSetter:function(e,t,n,r,i){this.addGetter(e,t,n);this.addSetter(e,t,r,i);this.addOverloadedGetterSetter(e,t)},addGetter:function(e,t,n){var r=h+Kinetic.Util._capitalize(t);e.prototype[r]=function(){var e=this.attrs[t];return e===undefined?n:e}},addSetter:function(e,t,n,r){var i=N+Kinetic.Util._capitalize(t);e.prototype[i]=function(e){if(n){e=n.call(this,e)}this._setAttr(t,e);if(r){r.call(this)}return this}},addComponentsGetterSetter:function(e,t,n,r,i){var s=n.length,o=Kinetic.Util._capitalize,u=h+o(t),a=N+o(t),f,l;e.prototype[u]=function(){var e={};for(f=0;f<s;f++){l=n[f];e[l]=this.getAttr(t+o(l))}return e};e.prototype[a]=function(e){var n=this.attrs[t],s;if(r){e=r.call(this,e)}for(s in e){this._setAttr(t+o(s),e[s])}this._fireChangeEvent(t,n,e);if(i){i.call(this)}return this};this.addOverloadedGetterSetter(e,t)},addOverloadedGetterSetter:function(e,t){var n=Kinetic.Util._capitalize(t),r=N+n,i=h+n;e.prototype[t]=function(){if(arguments.length){this[r](arguments[0]);return this}else{return this[i]()}}},backCompat:function(e,t){var n;for(n in t){e.prototype[n]=e.prototype[t[n]]}},afterSetFilter:function(){this._filterUpToDate=false}};Kinetic.Validators={RGBComponent:function(e){if(e>255){return 255}else if(e<0){return 0}else{return Math.round(e)}},alphaComponent:function(e){if(e>1){return 1}else if(e<1e-4){return 1e-4}else{return e}}}})();(function(){var e="absoluteOpacity",t="absoluteTransform",n="before",r="Change",i="children",s=".",o="",u="get",a="id",f="kinetic",l="listening",c="mouseenter",h="mouseleave",p="name",d="set",v="Shape",m=" ",g="stage",y="transform",b="Stage",w="visible",E=["id"],S=["xChange.kinetic","yChange.kinetic","scaleXChange.kinetic","scaleYChange.kinetic","skewXChange.kinetic","skewYChange.kinetic","rotationChange.kinetic","offsetXChange.kinetic","offsetYChange.kinetic","transformsEnabledChange.kinetic"].join(m);Kinetic.Util.addMethods(Kinetic.Node,{_init:function(n){var r=this;this._id=Kinetic.idCounter++;this.eventListeners={};this.attrs={};this._cache={};this._filterUpToDate=false;this.setAttrs(n);this.on(S,function(){this._clearCache(y);r._clearSelfAndDescendantCache(t)});this.on("visibleChange.kinetic",function(){r._clearSelfAndDescendantCache(w)});this.on("listeningChange.kinetic",function(){r._clearSelfAndDescendantCache(l)});this.on("opacityChange.kinetic",function(){r._clearSelfAndDescendantCache(e)})},_clearCache:function(e){if(e){delete this._cache[e]}else{this._cache={}}},_getCache:function(e,t){var n=this._cache[e];if(n===undefined){this._cache[e]=t.call(this)}return this._cache[e]},_clearSelfAndDescendantCache:function(e){this._clearCache(e);if(this.children){this.getChildren().each(function(t){t._clearSelfAndDescendantCache(e)})}},clearCache:function(){delete this._cache.canvas;this._filterUpToDate=false;return this},cache:function(e){var t=e||{},n=t.x||0,r=t.y||0,i=t.width||this.width(),s=t.height||this.height(),o=t.drawBorder||false,u=this.getLayer();if(i===0||s===0){Kinetic.Util.warn("Width or height of caching configuration equals 0. Cache is ignored.");return}var a=new Kinetic.SceneCanvas({pixelRatio:1,width:i,height:s}),f=new Kinetic.SceneCanvas({pixelRatio:1,width:i,height:s}),l=new Kinetic.HitCanvas({width:i,height:s}),c=this.transformsEnabled(),h=this.x(),p=this.y(),d=a.getContext(),v=l.getContext();this.clearCache();d.save();v.save();if(o){d.save();d.beginPath();d.rect(0,0,i,s);d.closePath();d.setAttr("strokeStyle","red");d.setAttr("lineWidth",5);d.stroke();d.restore()}d.translate(n*-1,r*-1);v.translate(n*-1,r*-1);if(this.nodeType==="Shape"){d.translate(this.x()*-1,this.y()*-1);v.translate(this.x()*-1,this.y()*-1)}this.drawScene(a,this);this.drawHit(l,this);d.restore();v.restore();this._cache.canvas={scene:a,filter:f,hit:l};return this},_drawCachedSceneCanvas:function(e){e.save();this.getLayer()._applyTransform(this,e);e.drawImage(this._getCachedSceneCanvas()._canvas,0,0);e.restore()},_getCachedSceneCanvas:function(){var e=this.filters(),t=this._cache.canvas,n=t.scene,r=t.filter,i=r.getContext(),s,o,u,a;if(e){if(!this._filterUpToDate){try{s=e.length;i.clear();i.drawImage(n._canvas,0,0);o=i.getImageData(0,0,r.getWidth(),r.getHeight());for(u=0;u<s;u++){a=e[u];a.call(this,o);i.putImageData(o,0,0)}}catch(f){Kinetic.Util.warn("Unable to apply filter. "+f.message)}this._filterUpToDate=true}return r}else{return n}},_drawCachedHitCanvas:function(e){var t=this._cache.canvas,n=t.hit;e.save();this.getLayer()._applyTransform(this,e);e.drawImage(n._canvas,0,0);e.restore()},on:function(e,t){var n=e.split(m),r=n.length,i,u,a,f,l;for(i=0;i<r;i++){u=n[i];a=u.split(s);f=a[0];l=a[1]||o;if(!this.eventListeners[f]){this.eventListeners[f]=[]}this.eventListeners[f].push({name:l,handler:t})}return this},off:function(e){var t=e.split(m),n=t.length,r,i,o,u,a,f;for(r=0;r<n;r++){o=t[r];u=o.split(s);a=u[0];f=u[1];if(a){if(this.eventListeners[a]){this._off(a,f)}}else{for(i in this.eventListeners){this._off(i,f)}}}return this},dispatchEvent:function(e){var t={target:this,type:e.type,evt:e};this.fire(e.type,t)},addEventListener:function(e,t){this.on(e,function(e){t.call(this,e.evt)})},remove:function(){var n=this.getParent();if(n&&n.children){n.children.splice(this.index,1);n._setChildrenIndices();delete this.parent}this._clearSelfAndDescendantCache(g);this._clearSelfAndDescendantCache(t);this._clearSelfAndDescendantCache(w);this._clearSelfAndDescendantCache(l);this._clearSelfAndDescendantCache(e);return this},destroy:function(){Kinetic._removeId(this.getId());Kinetic._removeName(this.getName(),this._id);this.remove()},getAttr:function(e){var t=u+Kinetic.Util._capitalize(e);if(Kinetic.Util._isFunction(this[t])){return this[t]()}else{return this.attrs[e]}},getAncestors:function(){var e=this.getParent(),t=new Kinetic.Collection;while(e){t.push(e);e=e.getParent()}return t},getAttrs:function(){return this.attrs||{}},setAttrs:function(e){var t,n;if(e){for(t in e){if(t===i){}else{n=d+Kinetic.Util._capitalize(t);if(Kinetic.Util._isFunction(this[n])){this[n](e[t])}else{this._setAttr(t,e[t])}}}}return this},isListening:function(){return this._getCache(l,this._isListening)},_isListening:function(){var e=this.getListening(),t=this.getParent();if(e==="inherit"){if(t){return t.isListening()}else{return true}}else{return e}},isVisible:function(){return this._getCache(w,this._isVisible)},_isVisible:function(){var e=this.getVisible(),t=this.getParent();if(e==="inherit"){if(t){return t.isVisible()}else{return true}}else{return e}},shouldDrawHit:function(){var e=this.getLayer();return e&&e.hitGraphEnabled()&&this.isListening()&&this.isVisible()&&!Kinetic.isDragging()},show:function(){this.setVisible(true);return this},hide:function(){this.setVisible(false);return this},getZIndex:function(){return this.index||0},getAbsoluteZIndex:function(){function u(a){r=[];i=a.length;for(s=0;s<i;s++){o=a[s];n++;if(o.nodeType!==v){r=r.concat(o.getChildren().toArray())}if(o._id===t._id){s=i}}if(r.length>0&&r[0].getDepth()<=e){u(r)}}var e=this.getDepth(),t=this,n=0,r,i,s,o;if(t.nodeType!==b){u(t.getStage().getChildren())}return n},getDepth:function(){var e=0,t=this.parent;while(t){e++;t=t.parent}return e},setPosition:function(e){this.setX(e.x);this.setY(e.y);return this},getPosition:function(){return{x:this.getX(),y:this.getY()}},getAbsolutePosition:function(){var e=this.getAbsoluteTransform().getMatrix(),t=new Kinetic.Transform,n=this.offset();t.m=e.slice();t.translate(n.x,n.y);return t.getTranslation()},setAbsolutePosition:function(e){var t=this._clearTransform(),n;this.attrs.x=t.x;this.attrs.y=t.y;delete t.x;delete t.y;n=this.getAbsoluteTransform();n.invert();n.translate(e.x,e.y);e={x:this.attrs.x+n.getTranslation().x,y:this.attrs.y+n.getTranslation().y};this.setPosition({x:e.x,y:e.y});this._setTransform(t);return this},_setTransform:function(e){var n;for(n in e){this.attrs[n]=e[n]}this._clearCache(y);this._clearSelfAndDescendantCache(t)},_clearTransform:function(){var e={x:this.getX(),y:this.getY(),rotation:this.getRotation(),scaleX:this.getScaleX(),scaleY:this.getScaleY(),offsetX:this.getOffsetX(),offsetY:this.getOffsetY(),skewX:this.getSkewX(),skewY:this.getSkewY()};this.attrs.x=0;this.attrs.y=0;this.attrs.rotation=0;this.attrs.scaleX=1;this.attrs.scaleY=1;this.attrs.offsetX=0;this.attrs.offsetY=0;this.attrs.skewX=0;this.attrs.skewY=0;this._clearCache(y);this._clearSelfAndDescendantCache(t);return e},move:function(e){var t=e.x,n=e.y,r=this.getX(),i=this.getY();if(t!==undefined){r+=t}if(n!==undefined){i+=n}this.setPosition({x:r,y:i});return this},_eachAncestorReverse:function(e,t){var n=[],r=this.getParent(),i,s;if(t&&t._id===this._id){e(this);return true}n.unshift(this);while(r&&(!t||r._id!==t._id)){n.unshift(r);r=r.parent}i=n.length;for(s=0;s<i;s++){e(n[s])}},rotate:function(e){this.setRotation(this.getRotation()+e);return this},moveToTop:function(){if(!this.parent){Kinetic.Util.warn("Node has no parent. moveToTop function is ignored.");return}var e=this.index;this.parent.children.splice(e,1);this.parent.children.push(this);this.parent._setChildrenIndices();return true},moveUp:function(){if(!this.parent){Kinetic.Util.warn("Node has no parent. moveUp function is ignored.");return}var e=this.index,t=this.parent.getChildren().length;if(e<t-1){this.parent.children.splice(e,1);this.parent.children.splice(e+1,0,this);this.parent._setChildrenIndices();return true}return false},moveDown:function(){if(!this.parent){Kinetic.Util.warn("Node has no parent. moveDown function is ignored.");return}var e=this.index;if(e>0){this.parent.children.splice(e,1);this.parent.children.splice(e-1,0,this);this.parent._setChildrenIndices();return true}return false},moveToBottom:function(){if(!this.parent){Kinetic.Util.warn("Node has no parent. moveToBottom function is ignored.");return}var e=this.index;if(e>0){this.parent.children.splice(e,1);this.parent.children.unshift(this);this.parent._setChildrenIndices();return true}return false},setZIndex:function(e){if(!this.parent){Kinetic.Util.warn("Node has no parent. zIndex parameter is ignored.");return}var t=this.index;this.parent.children.splice(t,1);this.parent.children.splice(e,0,this);this.parent._setChildrenIndices();return this},getAbsoluteOpacity:function(){return this._getCache(e,this._getAbsoluteOpacity)},_getAbsoluteOpacity:function(){var e=this.getOpacity();if(this.getParent()){e*=this.getParent().getAbsoluteOpacity()}return e},moveTo:function(e){Kinetic.Node.prototype.remove.call(this);e.add(this);return this},toObject:function(){var e=Kinetic.Util,t={},n=this.getAttrs(),r,i,s,o;t.attrs={};for(r in n){i=n[r];if(!e._isFunction(i)&&!e._isElement(i)&&!(e._isObject(i)&&e._hasMethods(i))){s=this[r];delete n[r];o=s?s.call(this):null;n[r]=i;if(o!==i){t.attrs[r]=i}}}t.className=this.getClassName();return t},toJSON:function(){return JSON.stringify(this.toObject())},getParent:function(){return this.parent},getLayer:function(){var e=this.getParent();return e?e.getLayer():null},getStage:function(){return this._getCache(g,this._getStage)},_getStage:function(){var e=this.getParent();if(e){return e.getStage()}else{return undefined}},fire:function(e,t,n){if(n){this._fireAndBubble(e,t||{})}else{this._fire(e,t||{})}return this},getAbsoluteTransform:function(e){if(e){return this._getAbsoluteTransform(e)}else{return this._getCache(t,this._getAbsoluteTransform)}},_getAbsoluteTransform:function(e){var t=new Kinetic.Transform,n,r;this._eachAncestorReverse(function(e){n=e.transformsEnabled();r=e.getTransform();if(n==="all"){t.multiply(r)}else if(n==="position"){t.translate(e.x(),e.y())}},e);return t},getTransform:function(){return this._getCache(y,this._getTransform)},_getTransform:function(){var e=new Kinetic.Transform,t=this.getX(),n=this.getY(),r=Kinetic.getAngle(this.getRotation()),i=this.getScaleX(),s=this.getScaleY(),o=this.getSkewX(),u=this.getSkewY(),a=this.getOffsetX(),f=this.getOffsetY();if(t!==0||n!==0){e.translate(t,n)}if(r!==0){e.rotate(r)}if(o!==0||u!==0){e.skew(o,u)}if(i!==1||s!==1){e.scale(i,s)}if(a!==0||f!==0){e.translate(-1*a,-1*f)}return e},clone:function(e){var t=this.getClassName(),n=Kinetic.Util.cloneObject(this.attrs),r,i,s,o,u;for(var a in E){var l=E[a];delete n[l]}for(r in e){n[r]=e[r]}var c=new Kinetic[t](n);for(r in this.eventListeners){i=this.eventListeners[r];s=i.length;for(o=0;o<s;o++){u=i[o];if(u.name.indexOf(f)<0){if(!c.eventListeners[r]){c.eventListeners[r]=[]}c.eventListeners[r].push(u)}}}return c},toDataURL:function(e){e=e||{};var t=e.mimeType||null,n=e.quality||null,r=this.getStage(),i=e.x||0,s=e.y||0,o=new Kinetic.SceneCanvas({width:e.width||this.getWidth()||(r?r.getWidth():0),height:e.height||this.getHeight()||(r?r.getHeight():0),pixelRatio:1}),u=o.getContext();u.save();if(i||s){u.translate(-1*i,-1*s)}this.drawScene(o);u.restore();return o.toDataURL(t,n)},toImage:function(e){Kinetic.Util._getImage(this.toDataURL(e),function(t){e.callback(t)})},setSize:function(e){this.setWidth(e.width);this.setHeight(e.height);return this},getSize:function(){return{width:this.getWidth(),height:this.getHeight()}},getWidth:function(){return this.attrs.width||0},getHeight:function(){return this.attrs.height||0},getClassName:function(){return this.className||this.nodeType},getType:function(){return this.nodeType},getDragDistance:function(){if(this.attrs.dragDistance!==undefined){return this.attrs.dragDistance}else if(this.parent){return this.parent.getDragDistance()}else{return Kinetic.dragDistance}},_get:function(e){return this.nodeType===e?[this]:[]},_off:function(e,t){var n=this.eventListeners[e],r,i;for(r=0;r<n.length;r++){i=n[r].name;if((i!=="kinetic"||t==="kinetic")&&(!t||i===t)){n.splice(r,1);if(n.length===0){delete this.eventListeners[e];break}r--}}},_fireChangeEvent:function(e,t,n){this._fire(e+r,{oldVal:t,newVal:n})},setId:function(e){var t=this.getId();Kinetic._removeId(t);Kinetic._addId(this,e);this._setAttr(a,e);return this},setName:function(e){var t=this.getName();Kinetic._removeName(t,this._id);Kinetic._addName(this,e);this._setAttr(p,e);return this},setAttr:function(){var e=Array.prototype.slice.call(arguments),t=e[0],n=e[1],r=d+Kinetic.Util._capitalize(t),i=this[r];if(Kinetic.Util._isFunction(i)){i.call(this,n)}else{this._setAttr(t,n)}return this},_setAttr:function(e,t){var n;if(t!==undefined){n=this.attrs[e];this.attrs[e]=t;this._fireChangeEvent(e,n,t)}},_setComponentAttr:function(e,t,n){var r;if(n!==undefined){r=this.attrs[e];if(!r){this.attrs[e]=this.getAttr(e)}this.attrs[e][t]=n;this._fireChangeEvent(e,r,n)}},_fireAndBubble:function(e,t,n){var r=true;if(t&&this.nodeType===v){t.target=this}if(e===c&&n&&this._id===n._id){r=false}else if(e===h&&n&&this._id===n._id){r=false}if(r){this._fire(e,t);if(t&&!t.cancelBubble&&this.parent){if(n&&n.parent){this._fireAndBubble.call(this.parent,e,t,n.parent)}else{this._fireAndBubble.call(this.parent,e,t)}}}},_fire:function(e,t){var n=this.eventListeners[e],r;t.type=e;if(n){for(r=0;r<n.length;r++){n[r].handler.call(this,t)}}},draw:function(){this.drawScene();this.drawHit();return this}});Kinetic.Node.create=function(e,t){return this._createNode(JSON.parse(e),t)};Kinetic.Node._createNode=function(e,t){var n=Kinetic.Node.prototype.getClassName.call(e),r=e.children,i,s,o;if(t){e.attrs.container=t}i=new Kinetic[n](e.attrs);if(r){s=r.length;for(o=0;o<s;o++){i.add(this._createNode(r[o]))}}return i};Kinetic.Factory.addOverloadedGetterSetter(Kinetic.Node,"position");Kinetic.Factory.addGetterSetter(Kinetic.Node,"x",0);Kinetic.Factory.addGetterSetter(Kinetic.Node,"y",0);Kinetic.Factory.addGetterSetter(Kinetic.Node,"opacity",1);Kinetic.Factory.addGetter(Kinetic.Node,"name");Kinetic.Factory.addOverloadedGetterSetter(Kinetic.Node,"name");Kinetic.Factory.addGetter(Kinetic.Node,"id");Kinetic.Factory.addOverloadedGetterSetter(Kinetic.Node,"id");Kinetic.Factory.addGetterSetter(Kinetic.Node,"rotation",0);Kinetic.Factory.addComponentsGetterSetter(Kinetic.Node,"scale",["x","y"]);Kinetic.Factory.addGetterSetter(Kinetic.Node,"scaleX",1);Kinetic.Factory.addGetterSetter(Kinetic.Node,"scaleY",1);Kinetic.Factory.addComponentsGetterSetter(Kinetic.Node,"skew",["x","y"]);Kinetic.Factory.addGetterSetter(Kinetic.Node,"skewX",0);Kinetic.Factory.addGetterSetter(Kinetic.Node,"skewY",0);Kinetic.Factory.addComponentsGetterSetter(Kinetic.Node,"offset",["x","y"]);Kinetic.Factory.addGetterSetter(Kinetic.Node,"offsetX",0);Kinetic.Factory.addGetterSetter(Kinetic.Node,"offsetY",0);Kinetic.Factory.addSetter(Kinetic.Node,"dragDistance");Kinetic.Factory.addOverloadedGetterSetter(Kinetic.Node,"dragDistance");Kinetic.Factory.addSetter(Kinetic.Node,"width",0);Kinetic.Factory.addOverloadedGetterSetter(Kinetic.Node,"width");Kinetic.Factory.addSetter(Kinetic.Node,"height",0);Kinetic.Factory.addOverloadedGetterSetter(Kinetic.Node,"height");Kinetic.Factory.addGetterSetter(Kinetic.Node,"listening","inherit");Kinetic.Factory.addGetterSetter(Kinetic.Node,"filters",undefined,function(e){this._filterUpToDate=false;return e});Kinetic.Factory.addGetterSetter(Kinetic.Node,"visible","inherit");Kinetic.Factory.addGetterSetter(Kinetic.Node,"transformsEnabled","all");Kinetic.Factory.addOverloadedGetterSetter(Kinetic.Node,"size");Kinetic.Factory.backCompat(Kinetic.Node,{rotateDeg:"rotate",setRotationDeg:"setRotation",getRotationDeg:"getRotation"});Kinetic.Collection.mapMethods(Kinetic.Node)})();(function(){Kinetic.Filters.Grayscale=function(e){var t=e.data,n=t.length,r,i;for(r=0;r<n;r+=4){i=.34*t[r]+.5*t[r+1]+.16*t[r+2];t[r]=i;t[r+1]=i;t[r+2]=i}}})();(function(){Kinetic.Filters.Brighten=function(e){var t=this.brightness()*255,n=e.data,r=n.length,i;for(i=0;i<r;i+=4){n[i]+=t;n[i+1]+=t;n[i+2]+=t}};Kinetic.Factory.addGetterSetter(Kinetic.Node,"brightness",0,null,Kinetic.Factory.afterSetFilter)})();(function(){Kinetic.Filters.Invert=function(e){var t=e.data,n=t.length,r;for(r=0;r<n;r+=4){t[r]=255-t[r];t[r+1]=255-t[r+1];t[r+2]=255-t[r+2]}}})();(function(){function e(){this.r=0;this.g=0;this.b=0;this.a=0;this.next=null}function r(r,i){var s=r.data,o=r.width,u=r.height;var a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M;var _=i+i+1,D=o-1,P=u-1,H=i+1,B=H*(H+1)/2,j=new e,F=null,I=j,q=null,R=null,U=t[i],z=n[i];for(l=1;l<_;l++){I=I.next=new e;if(l==H){F=I}}I.next=j;d=p=0;for(f=0;f<u;f++){x=T=N=C=v=m=g=y=0;b=H*(k=s[p]);w=H*(L=s[p+1]);E=H*(A=s[p+2]);S=H*(O=s[p+3]);v+=B*k;m+=B*L;g+=B*A;y+=B*O;I=j;for(l=0;l<H;l++){I.r=k;I.g=L;I.b=A;I.a=O;I=I.next}for(l=1;l<H;l++){c=p+((D<l?D:l)<<2);v+=(I.r=k=s[c])*(M=H-l);m+=(I.g=L=s[c+1])*M;g+=(I.b=A=s[c+2])*M;y+=(I.a=O=s[c+3])*M;x+=k;T+=L;N+=A;C+=O;I=I.next}q=j;R=F;for(a=0;a<o;a++){s[p+3]=O=y*U>>z;if(O!==0){O=255/O;s[p]=(v*U>>z)*O;s[p+1]=(m*U>>z)*O;s[p+2]=(g*U>>z)*O}else{s[p]=s[p+1]=s[p+2]=0}v-=b;m-=w;g-=E;y-=S;b-=q.r;w-=q.g;E-=q.b;S-=q.a;c=d+((c=a+i+1)<D?c:D)<<2;x+=q.r=s[c];T+=q.g=s[c+1];N+=q.b=s[c+2];C+=q.a=s[c+3];v+=x;m+=T;g+=N;y+=C;q=q.next;b+=k=R.r;w+=L=R.g;E+=A=R.b;S+=O=R.a;x-=k;T-=L;N-=A;C-=O;R=R.next;p+=4}d+=o}for(a=0;a<o;a++){T=N=C=x=m=g=y=v=0;p=a<<2;b=H*(k=s[p]);w=H*(L=s[p+1]);E=H*(A=s[p+2]);S=H*(O=s[p+3]);v+=B*k;m+=B*L;g+=B*A;y+=B*O;I=j;for(l=0;l<H;l++){I.r=k;I.g=L;I.b=A;I.a=O;I=I.next}h=o;for(l=1;l<=i;l++){p=h+a<<2;v+=(I.r=k=s[p])*(M=H-l);m+=(I.g=L=s[p+1])*M;g+=(I.b=A=s[p+2])*M;y+=(I.a=O=s[p+3])*M;x+=k;T+=L;N+=A;C+=O;I=I.next;if(l<P){h+=o}}p=a;q=j;R=F;for(f=0;f<u;f++){c=p<<2;s[c+3]=O=y*U>>z;if(O>0){O=255/O;s[c]=(v*U>>z)*O;s[c+1]=(m*U>>z)*O;s[c+2]=(g*U>>z)*O}else{s[c]=s[c+1]=s[c+2]=0}v-=b;m-=w;g-=E;y-=S;b-=q.r;w-=q.g;E-=q.b;S-=q.a;c=a+((c=f+H)<P?c:P)*o<<2;v+=x+=q.r=s[c];m+=T+=q.g=s[c+1];g+=N+=q.b=s[c+2];y+=C+=q.a=s[c+3];q=q.next;b+=k=R.r;w+=L=R.g;E+=A=R.b;S+=O=R.a;x-=k;T-=L;N-=A;C-=O;R=R.next;p+=o}}}var t=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259];var n=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];Kinetic.Filters.Blur=function(e){var t=Math.round(this.blurRadius());if(t>0){r(e,t)}};Kinetic.Factory.addGetterSetter(Kinetic.Node,"blurRadius",0,null,Kinetic.Factory.afterSetFilter)})();(function(){function e(e,t,n){var r=(n*e.width+t)*4;var i=[];i.push(e.data[r++],e.data[r++],e.data[r++],e.data[r++]);return i}function t(e,t){return Math.sqrt(Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2)+Math.pow(e[2]-t[2],2))}function n(e){var t=[0,0,0];for(var n=0;n<e.length;n++){t[0]+=e[n][0];t[1]+=e[n][1];t[2]+=e[n][2]}t[0]/=e.length;t[1]/=e.length;t[2]/=e.length;return t}function r(r,i){var s=e(r,0,0);var o=e(r,r.width-1,0);var u=e(r,0,r.height-1);var a=e(r,r.width-1,r.height-1);var f=i||10;if(t(s,o)<f&&t(o,a)<f&&t(a,u)<f&&t(u,s)<f){var l=n([o,s,a,u]);var c=[];for(var h=0;h<r.width*r.height;h++){var p=t(l,[r.data[h*4],r.data[h*4+1],r.data[h*4+2]]);c[h]=p<f?0:255}return c}}function i(e,t){for(var n=0;n<e.width*e.height;n++){e.data[4*n+3]=t[n]}}function s(e,t,n){var r=[1,1,1,1,0,1,1,1,1];var i=Math.round(Math.sqrt(r.length));var s=Math.floor(i/2);var o=[];for(var u=0;u<n;u++){for(var a=0;a<t;a++){var f=u*t+a;var l=0;for(var c=0;c<i;c++){for(var h=0;h<i;h++){var p=u+c-s;var d=a+h-s;if(p>=0&&p<n&&d>=0&&d<t){var v=p*t+d;var m=r[c*i+h];l+=e[v]*m}}}o[f]=l===255*8?255:0}}return o}function o(e,t,n){var r=[1,1,1,1,1,1,1,1,1];var i=Math.round(Math.sqrt(r.length));var s=Math.floor(i/2);var o=[];for(var u=0;u<n;u++){for(var a=0;a<t;a++){var f=u*t+a;var l=0;for(var c=0;c<i;c++){for(var h=0;h<i;h++){var p=u+c-s;var d=a+h-s;if(p>=0&&p<n&&d>=0&&d<t){var v=p*t+d;var m=r[c*i+h];l+=e[v]*m}}}o[f]=l>=255*4?255:0}}return o}function u(e,t,n){var r=[1/9,1/9,1/9,1/9,1/9,1/9,1/9,1/9,1/9];var i=Math.round(Math.sqrt(r.length));var s=Math.floor(i/2);var o=[];for(var u=0;u<n;u++){for(var a=0;a<t;a++){var f=u*t+a;var l=0;for(var c=0;c<i;c++){for(var h=0;h<i;h++){var p=u+c-s;var d=a+h-s;if(p>=0&&p<n&&d>=0&&d<t){var v=p*t+d;var m=r[c*i+h];l+=e[v]*m}}}o[f]=l}}return o}Kinetic.Filters.Mask=function(e){var t=this.threshold(),n=r(e,t);if(n){n=s(n,e.width,e.height);n=o(n,e.width,e.height);n=u(n,e.width,e.height);i(e,n)}return e};Kinetic.Factory.addGetterSetter(Kinetic.Node,"threshold",0,null,Kinetic.Factory.afterSetFilter)})();(function(){Kinetic.Filters.RGB=function(e){var t=e.data,n=t.length,r=this.red(),i=this.green(),s=this.blue(),o,u;for(o=0;o<n;o+=4){u=(.34*t[o]+.5*t[o+1]+.16*t[o+2])/255;t[o]=u*r;t[o+1]=u*i;t[o+2]=u*s;t[o+3]=t[o+3]}};Kinetic.Factory.addGetterSetter(Kinetic.Node,"red",0,function(e){this._filterUpToDate=false;if(e>255){return 255}else if(e<0){return 0}else{return Math.round(e)}});Kinetic.Factory.addGetterSetter(Kinetic.Node,"green",0,function(e){this._filterUpToDate=false;if(e>255){return 255}else if(e<0){return 0}else{return Math.round(e)}});Kinetic.Factory.addGetterSetter(Kinetic.Node,"blue",0,Kinetic.Validators.RGBComponent,Kinetic.Factory.afterSetFilter)})();(function(){Kinetic.Filters.HSV=function(e){var t=e.data,n=t.length,r=Math.pow(2,this.value()),i=Math.pow(2,this.saturation()),s=Math.abs(this.hue()+360)%360,o;var u=r*i*Math.cos(s*Math.PI/180),a=r*i*Math.sin(s*Math.PI/180);var f=.299*r+.701*u+.167*a,l=.587*r-.587*u+.33*a,c=.114*r-.114*u-.497*a;var h=.299*r-.299*u-.328*a,p=.587*r+.413*u+.035*a,d=.114*r-.114*u+.293*a;var v=.299*r-.3*u+1.25*a,m=.587*r-.586*u-1.05*a,g=.114*r+.886*u-.2*a;var y,b,w,E;for(o=0;o<n;o+=4){y=t[o+0];b=t[o+1];w=t[o+2];E=t[o+3];t[o+0]=f*y+l*b+c*w;t[o+1]=h*y+p*b+d*w;t[o+2]=v*y+m*b+g*w;t[o+3]=E}};Kinetic.Factory.addGetterSetter(Kinetic.Node,"hue",0,null,Kinetic.Factory.afterSetFilter);Kinetic.Factory.addGetterSetter(Kinetic.Node,"saturation",0,null,Kinetic.Factory.afterSetFilter);Kinetic.Factory.addGetterSetter(Kinetic.Node,"value",0,null,Kinetic.Factory.afterSetFilter)})();(function(){Kinetic.Factory.addGetterSetter(Kinetic.Node,"hue",0,null,Kinetic.Factory.afterSetFilter);Kinetic.Factory.addGetterSetter(Kinetic.Node,"saturation",0,null,Kinetic.Factory.afterSetFilter);Kinetic.Factory.addGetterSetter(Kinetic.Node,"luminance",0,null,Kinetic.Factory.afterSetFilter);Kinetic.Filters.HSL=function(e){var t=e.data,n=t.length,r=1,i=Math.pow(2,this.saturation()),s=Math.abs(this.hue()+360)%360,o=this.luminance()*127,u;var a=r*i*Math.cos(s*Math.PI/180),f=r*i*Math.sin(s*Math.PI/180);var l=.299*r+.701*a+.167*f,c=.587*r-.587*a+.33*f,h=.114*r-.114*a-.497*f;var p=.299*r-.299*a-.328*f,d=.587*r+.413*a+.035*f,v=.114*r-.114*a+.293*f;var m=.299*r-.3*a+1.25*f,g=.587*r-.586*a-1.05*f,y=.114*r+.886*a-.2*f;var b,w,E,S;for(u=0;u<n;u+=4){b=t[u+0];w=t[u+1];E=t[u+2];S=t[u+3];t[u+0]=l*b+c*w+h*E+o;t[u+1]=p*b+d*w+v*E+o;t[u+2]=m*b+g*w+y*E+o;t[u+3]=S}}})();(function(){Kinetic.Filters.Emboss=function(e){var t=this.embossStrength()*10,n=this.embossWhiteLevel()*255,r=this.embossDirection(),i=this.embossBlend(),s=0,o=0,u=e.data,a=e.width,f=e.height,l=a*4,c=f;switch(r){case"top-left":s=-1;o=-1;break;case"top":s=-1;o=0;break;case"top-right":s=-1;o=1;break;case"right":s=0;o=1;break;case"bottom-right":s=1;o=1;break;case"bottom":s=1;o=0;break;case"bottom-left":s=1;o=-1;break;case"left":s=0;o=-1;break}do{var h=(c-1)*l;var p=s;if(c+p<1){p=0}if(c+p>f){p=0}var d=(c-1+p)*a*4;var v=a;do{var m=h+(v-1)*4;var g=o;if(v+g<1){g=0}if(v+g>a){g=0}var y=d+(v-1+g)*4;var b=u[m]-u[y];var w=u[m+1]-u[y+1];var E=u[m+2]-u[y+2];var S=b;var x=S>0?S:-S;var T=w>0?w:-w;var N=E>0?E:-E;if(T>x){S=w}if(N>x){S=E}S*=t;if(i){var C=u[m]+S;var k=u[m+1]+S;var L=u[m+2]+S;u[m]=C>255?255:C<0?0:C;u[m+1]=k>255?255:k<0?0:k;u[m+2]=L>255?255:L<0?0:L}else{var A=n-S;if(A<0){A=0}else if(A>255){A=255}u[m]=u[m+1]=u[m+2]=A}}while(--v)}while(--c)};Kinetic.Factory.addGetterSetter(Kinetic.Node,"embossStrength",.5,null,Kinetic.Factory.afterSetFilter);Kinetic.Factory.addGetterSetter(Kinetic.Node,"embossWhiteLevel",.5,null,Kinetic.Factory.afterSetFilter);Kinetic.Factory.addGetterSetter(Kinetic.Node,"embossDirection","top-left",null,Kinetic.Factory.afterSetFilter);Kinetic.Factory.addGetterSetter(Kinetic.Node,"embossBlend",false,null,Kinetic.Factory.afterSetFilter)})();(function(){function e(e,t,n,r,i){var s=n-t,o=i-r,u;if(s===0){return r+o/2}if(o===0){return r}u=(e-t)/s;u=o*u+r;return u}Kinetic.Filters.Enhance=function(t){var n=t.data,r=n.length,i=n[0],s=i,o,u=n[1],a=u,f,l=n[2],c=l,h,p=n[3],d=p,v;var m=this.enhance();if(m===0){return}for(v=0;v<r;v+=4){o=n[v+0];if(o<i){i=o}else if(o>s){s=o}f=n[v+1];if(f<u){u=f}else if(f>a){a=f}h=n[v+2];if(h<l){l=h}else if(h>c){c=h}}if(s===i){s=255;i=0}if(a===u){a=255;u=0}if(c===l){c=255;l=0}if(d===p){d=255;p=0}var g,y,b,w,E,S,x,T,N,C,k,L;if(m>0){y=s+m*(255-s);b=i-m*(i-0);E=a+m*(255-a);S=u-m*(u-0);T=c+m*(255-c);L=l-m*(l-0);k=d+m*(255-d);N=p-m*(p-0)}else{g=(s+i)*.5;y=s+m*(s-g);b=i+m*(i-g);w=(a+u)*.5;E=a+m*(a-w);S=u+m*(u-w);x=(c+l)*.5;T=c+m*(c-x);L=l+m*(l-x);C=(d+p)*.5;k=d+m*(d-C);N=p+m*(p-C)}for(v=0;v<r;v+=4){n[v+0]=e(n[v+0],i,s,b,y);n[v+1]=e(n[v+1],u,a,S,E);n[v+2]=e(n[v+2],l,c,L,T)}};Kinetic.Factory.addGetterSetter(Kinetic.Node,"enhance",0,null,Kinetic.Factory.afterSetFilter)})();(function(){Kinetic.Filters.Posterize=function(e){var t=Math.round(this.levels()*254)+1,n=e.data,r=n.length,i=255/t,s;for(s=0;s<r;s+=1){n[s]=Math.floor(n[s]/i)*i}};Kinetic.Factory.addGetterSetter(Kinetic.Node,"levels",.5,null,Kinetic.Factory.afterSetFilter)})();(function(){Kinetic.Filters.Noise=function(e){var t=this.noise()*255,n=e.data,r=n.length,i=t/2,s;for(s=0;s<r;s+=4){n[s+0]+=i-2*i*Math.random();n[s+1]+=i-2*i*Math.random();n[s+2]+=i-2*i*Math.random()}};Kinetic.Factory.addGetterSetter(Kinetic.Node,"noise",.2,null,Kinetic.Factory.afterSetFilter)})();(function(){Kinetic.Filters.Pixelate=function(e){var t=Math.ceil(this.pixelSize()),n=e.width,r=e.height,i,s,o,u,a,f,l,c=Math.ceil(n/t),h=Math.ceil(r/t),p,d,v,m,g,y,b;e=e.data;for(g=0;g<c;g+=1){for(y=0;y<h;y+=1){u=0;a=0;f=0;l=0;p=g*t;d=p+t;v=y*t;m=v+t;b=0;for(i=p;i<d;i+=1){if(i>=n){continue}for(s=v;s<m;s+=1){if(s>=r){continue}o=(n*s+i)*4;u+=e[o+0];a+=e[o+1];f+=e[o+2];l+=e[o+3];b+=1}}u=u/b;a=a/b;f=f/b;for(i=p;i<d;i+=1){if(i>=n){continue}for(s=v;s<m;s+=1){if(s>=r){continue}o=(n*s+i)*4;e[o+0]=u;e[o+1]=a;e[o+2]=f;e[o+3]=l}}}}};Kinetic.Factory.addGetterSetter(Kinetic.Node,"pixelSize",8,null,Kinetic.Factory.afterSetFilter)})();(function(){Kinetic.Filters.Threshold=function(e){var t=this.threshold()*255,n=e.data,r=n.length,i;for(i=0;i<r;i+=1){n[i]=n[i]<t?0:255}};Kinetic.Factory.addGetterSetter(Kinetic.Node,"threshold",.5,null,Kinetic.Factory.afterSetFilter)})();(function(){Kinetic.Filters.Sepia=function(e){var t=e.data,n=e.width,r=e.height,i=n*4,s,o,u,a,f,l,c,h,p;do{s=(r-1)*i;o=n;do{u=s+(o-1)*4;a=t[u];f=t[u+1];l=t[u+2];c=a*.393+f*.769+l*.189;h=a*.349+f*.686+l*.168;p=a*.272+f*.534+l*.131;t[u]=c>255?255:c;t[u+1]=h>255?255:h;t[u+2]=p>255?255:p;t[u+3]=t[u+3]}while(--o)}while(--r)}})();(function(){Kinetic.Filters.Solarize=function(e){var t=e.data,n=e.width,r=e.height,i=n*4,s=r;do{var o=(s-1)*i;var u=n;do{var a=o+(u-1)*4;var f=t[a];var l=t[a+1];var c=t[a+2];if(f>127){f=255-f}if(l>127){l=255-l}if(c>127){c=255-c}t[a]=f;t[a+1]=l;t[a+2]=c}while(--u)}while(--s)}})();(function(){var e=function(e,t,n){var r=e.data,i=t.data,s=e.width,o=e.height,u=n.polarCenterX||s/2,a=n.polarCenterY||o/2,f,l,c,h=0,p=0,d=0,v=0;var m,g=Math.sqrt(u*u+a*a);l=s-u;c=o-a;m=Math.sqrt(l*l+c*c);g=m>g?m:g;var y=o,b=s,w,E;var S=360/b*Math.PI/180,x,T;for(E=0;E<b;E+=1){x=Math.sin(E*S);T=Math.cos(E*S);for(w=0;w<y;w+=1){l=Math.floor(u+g*w/y*T);c=Math.floor(a+g*w/y*x);f=(c*s+l)*4;h=r[f+0];p=r[f+1];d=r[f+2];v=r[f+3];f=(E+w*s)*4;i[f+0]=h;i[f+1]=p;i[f+2]=d;i[f+3]=v}}};var t=function(e,t,n){var r=e.data,i=t.data,s=e.width,o=e.height,u=n.polarCenterX||s/2,a=n.polarCenterY||o/2,f,l,c,h,p,d=0,v=0,m=0,g=0;var y,b=Math.sqrt(u*u+a*a);l=s-u;c=o-a;y=Math.sqrt(l*l+c*c);b=y>b?y:b;var w=o,E=s,S,x,T=n.polarRotation||0;var N,C;for(l=0;l<s;l+=1){for(c=0;c<o;c+=1){h=l-u;p=c-a;S=Math.sqrt(h*h+p*p)*w/b;x=(Math.atan2(p,h)*180/Math.PI+360+T)%360;x=x*E/360;N=Math.floor(x);C=Math.floor(S);f=(C*s+N)*4;d=r[f+0];v=r[f+1];m=r[f+2];g=r[f+3];f=(c*s+l)*4;i[f+0]=d;i[f+1]=v;i[f+2]=m;i[f+3]=g}}};var n=Kinetic.Util.createCanvasElement();Kinetic.Filters.Kaleidoscope=function(r){var i=r.width,s=r.height;var o,u,a,f,l,c,h,p,d,v;var m=Math.round(this.kaleidoscopePower());var g=Math.round(this.kaleidoscopeAngle());var y=Math.floor(i*(g%360)/360);if(m<1){return}n.width=i;n.height=s;var b=n.getContext("2d").getImageData(0,0,i,s);e(r,b,{polarCenterX:i/2,polarCenterY:s/2});var w=i/Math.pow(2,m);while(w<=8){w=w*2;m-=1}w=Math.ceil(w);var E=w;var S=0,x=E,T=1;if(y+w>i){S=E;x=0;T=-1}for(u=0;u<s;u+=1){for(o=S;o!==x;o+=T){a=Math.round(o+y)%i;d=(i*u+a)*4;l=b.data[d+0];c=b.data[d+1];h=b.data[d+2];p=b.data[d+3];v=(i*u+o)*4;b.data[v+0]=l;b.data[v+1]=c;b.data[v+2]=h;b.data[v+3]=p}}for(u=0;u<s;u+=1){E=Math.floor(w);for(f=0;f<m;f+=1){for(o=0;o<E+1;o+=1){d=(i*u+o)*4;l=b.data[d+0];c=b.data[d+1];h=b.data[d+2];p=b.data[d+3];v=(i*u+E*2-o-1)*4;b.data[v+0]=l;b.data[v+1]=c;b.data[v+2]=h;b.data[v+3]=p}E*=2}}t(b,r,{polarRotation:0})};Kinetic.Factory.addGetterSetter(Kinetic.Node,"kaleidoscopePower",2,null,Kinetic.Factory.afterSetFilter);Kinetic.Factory.addGetterSetter(Kinetic.Node,"kaleidoscopeAngle",0,null,Kinetic.Factory.afterSetFilter)})();(function(){function r(e){Kinetic.root.setTimeout(e,1e3/60)}function i(){return n.apply(Kinetic.root,arguments)}var e=500;var t=function(){if(Kinetic.root.performance&&Kinetic.root.performance.now){return function(){return Kinetic.root.performance.now()}}else{return function(){return(new Date).getTime()}}}();var n=function(){return Kinetic.root.requestAnimationFrame||Kinetic.root.webkitRequestAnimationFrame||Kinetic.root.mozRequestAnimationFrame||Kinetic.root.oRequestAnimationFrame||Kinetic.root.msRequestAnimationFrame||r}();Kinetic.Animation=function(e,n){var r=Kinetic.Animation;this.func=e;this.setLayers(n);this.id=r.animIdCounter++;this.frame={time:0,timeDiff:0,lastTime:t()}};Kinetic.Animation.prototype={setLayers:function(e){var t=[];if(!e){t=[]}else if(e.length>0){t=e}else{t=[e]}this.layers=t},getLayers:function(){return this.layers},addLayer:function(e){var t=this.layers,n,r;if(t){n=t.length;for(r=0;r<n;r++){if(t[r]._id===e._id){return false}}}else{this.layers=[]}this.layers.push(e);return true},isRunning:function(){var e=Kinetic.Animation,t=e.animations,n=t.length,r;for(r=0;r<n;r++){if(t[r].id===this.id){return true}}return false},start:function(){var e=Kinetic.Animation;this.stop();this.frame.timeDiff=0;this.frame.lastTime=t();e._addAnimation(this)},stop:function(){Kinetic.Animation._removeAnimation(this)},_updateFrameObject:function(e){this.frame.timeDiff=e-this.frame.lastTime;this.frame.lastTime=e;this.frame.time+=this.frame.timeDiff;this.frame.frameRate=1e3/this.frame.timeDiff}};Kinetic.Animation.animations=[];Kinetic.Animation.animIdCounter=0;Kinetic.Animation.animRunning=false;Kinetic.Animation._addAnimation=function(e){this.animations.push(e);this._handleAnimation()};Kinetic.Animation._removeAnimation=function(e){var t=e.id,n=this.animations,r=n.length,i;for(i=0;i<r;i++){if(n[i].id===t){this.animations.splice(i,1);break}}};Kinetic.Animation._runFrames=function(){var e={},n=this.animations,r,i,s,o,u,a,f,l;for(o=0;o<n.length;o++){r=n[o];i=r.layers;s=r.func;r._updateFrameObject(t());a=i.length;for(u=0;u<a;u++){f=i[u];if(f._id!==undefined){e[f._id]=f}}if(s){s.call(r,r.frame)}}for(l in e){e[l].draw()}};Kinetic.Animation._animationLoop=function(){var e=Kinetic.Animation;if(e.animations.length){i(e._animationLoop);e._runFrames()}else{e.animRunning=false}};Kinetic.Animation._handleAnimation=function(){var e=this;if(!this.animRunning){this.animRunning=true;e._animationLoop()}};var s=Kinetic.Node.prototype.moveTo;Kinetic.Node.prototype.moveTo=function(e){s.call(this,e)};Kinetic.Layer.prototype.batchDraw=function(){var n=this,r=Kinetic.Animation;if(!this.batchAnim){this.batchAnim=new r(function(){if(n.lastBatchDrawTime&&t()-n.lastBatchDrawTime>e){n.batchAnim.stop()}},this)}this.lastBatchDrawTime=t();if(!this.batchAnim.isRunning()){this.draw();this.batchAnim.start()}};Kinetic.Stage.prototype.batchDraw=function(){this.getChildren().each(function(e){e.batchDraw()})}})((1,eval)("this"));(function(){var e={node:1,duration:1,easing:1,onFinish:1,yoyo:1},t=1,n=2,r=3,i=0;Kinetic.Tween=function(t){var n=this,r=t.node,o=r._id,u=t.duration||1,a=t.easing||Kinetic.Easings.Linear,f=!!t.yoyo,l;this.node=r;this._id=i++;this.anim=new Kinetic.Animation(function(){n.tween.onEnterFrame()},r.getLayer());this.tween=new s(l,function(e){n._tweenFunc(e)},a,0,1,u*1e3,f);this._addListeners();if(!Kinetic.Tween.attrs[o]){Kinetic.Tween.attrs[o]={}}if(!Kinetic.Tween.attrs[o][this._id]){Kinetic.Tween.attrs[o][this._id]={}}if(!Kinetic.Tween.tweens[o]){Kinetic.Tween.tweens[o]={}}for(l in t){if(e[l]===undefined){this._addAttr(l,t[l])}}this.reset();this.onFinish=t.onFinish;this.onReset=t.onReset};Kinetic.Tween.attrs={};Kinetic.Tween.tweens={};Kinetic.Tween.prototype={_addAttr:function(e,t){var n=this.node,r=n._id,i,s,o,u,a;o=Kinetic.Tween.tweens[r][e];if(o){delete Kinetic.Tween.attrs[r][o][e]}i=n.getAttr(e);if(Kinetic.Util._isArray(t)){s=[];a=t.length;for(u=0;u<a;u++){s.push(t[u]-i[u])}}else{s=t-i}Kinetic.Tween.attrs[r][this._id][e]={start:i,diff:s};Kinetic.Tween.tweens[r][e]=this._id},_tweenFunc:function(e){var t=this.node,n=Kinetic.Tween.attrs[t._id][this._id],r,i,s,o,u,a,f;for(r in n){i=n[r];s=i.start;o=i.diff;if(Kinetic.Util._isArray(s)){u=[];f=s.length;for(a=0;a<f;a++){u.push(s[a]+o[a]*e)}}else{u=s+o*e}t.setAttr(r,u)}},_addListeners:function(){var e=this;this.tween.onPlay=function(){e.anim.start()};this.tween.onReverse=function(){e.anim.start()};this.tween.onPause=function(){e.anim.stop()};this.tween.onFinish=function(){if(e.onFinish){e.onFinish()}};this.tween.onReset=function(){if(e.onReset){e.onReset()}}},play:function(){this.tween.play();return this},reverse:function(){this.tween.reverse();return this},reset:function(){var e=this.node;this.tween.reset();return this},seek:function(e){var t=this.node;this.tween.seek(e*1e3);return this},pause:function(){this.tween.pause();return this},finish:function(){var e=this.node;this.tween.finish();return this},destroy:function(){var e=this.node._id,t=this._id,n=Kinetic.Tween.tweens[e],r;this.pause();for(r in n){delete Kinetic.Tween.tweens[e][r]}delete Kinetic.Tween.attrs[e][t]}};var s=function(e,t,n,r,i,s,o){this.prop=e;this.propFunc=t;this.begin=r;this._pos=r;this.duration=s;this._change=0;this.prevPos=0;this.yoyo=o;this._time=0;this._position=0;this._startTime=0;this._finish=0;this.func=n;this._change=i-this.begin;this.pause()};s.prototype={fire:function(e){var t=this[e];if(t){t()}},setTime:function(e){if(e>this.duration){if(this.yoyo){this._time=this.duration;this.reverse()}else{this.finish()}}else if(e<0){if(this.yoyo){this._time=0;this.play()}else{this.reset()}}else{this._time=e;this.update()}},getTime:function(){return this._time},setPosition:function(e){this.prevPos=this._pos;this.propFunc(e);this._pos=e},getPosition:function(e){if(e===undefined){e=this._time}return this.func(e,this.begin,this._change,this.duration)},play:function(){this.state=n;this._startTime=this.getTimer()-this._time;this.onEnterFrame();this.fire("onPlay")},reverse:function(){this.state=r;this._time=this.duration-this._time;this._startTime=this.getTimer()-this._time;this.onEnterFrame();this.fire("onReverse")},seek:function(e){this.pause();this._time=e;this.update();this.fire("onSeek")},reset:function(){this.pause();this._time=0;this.update();this.fire("onReset")},finish:function(){this.pause();this._time=this.duration;this.update();this.fire("onFinish")},update:function(){this.setPosition(this.getPosition(this._time))},onEnterFrame:function(){var e=this.getTimer()-this._startTime;if(this.state===n){this.setTime(e)}else if(this.state===r){this.setTime(this.duration-e)}},pause:function(){this.state=t;this.fire("onPause")},getTimer:function(){return(new Date).getTime()}};Kinetic.Easings={BackEaseIn:function(e,t,n,r){var i=1.70158;return n*(e/=r)*e*((i+1)*e-i)+t},BackEaseOut:function(e,t,n,r){var i=1.70158;return n*((e=e/r-1)*e*((i+1)*e+i)+1)+t},BackEaseInOut:function(e,t,n,r){var i=1.70158;if((e/=r/2)<1){return n/2*e*e*(((i*=1.525)+1)*e-i)+t}return n/2*((e-=2)*e*(((i*=1.525)+1)*e+i)+2)+t},ElasticEaseIn:function(e,t,n,r,i,s){var o=0;if(e===0){return t}if((e/=r)==1){return t+n}if(!s){s=r*.3}if(!i||i<Math.abs(n)){i=n;o=s/4}else{o=s/(2*Math.PI)*Math.asin(n/i)}return-(i*Math.pow(2,10*(e-=1))*Math.sin((e*r-o)*2*Math.PI/s))+t},ElasticEaseOut:function(e,t,n,r,i,s){var o=0;if(e===0){return t}if((e/=r)==1){return t+n}if(!s){s=r*.3}if(!i||i<Math.abs(n)){i=n;o=s/4}else{o=s/(2*Math.PI)*Math.asin(n/i)}return i*Math.pow(2,-10*e)*Math.sin((e*r-o)*2*Math.PI/s)+n+t},ElasticEaseInOut:function(e,t,n,r,i,s){var o=0;if(e===0){return t}if((e/=r/2)==2){return t+n}if(!s){s=r*.3*1.5}if(!i||i<Math.abs(n)){i=n;o=s/4}else{o=s/(2*Math.PI)*Math.asin(n/i)}if(e<1){return-.5*i*Math.pow(2,10*(e-=1))*Math.sin((e*r-o)*2*Math.PI/s)+t}return i*Math.pow(2,-10*(e-=1))*Math.sin((e*r-o)*2*Math.PI/s)*.5+n+t},BounceEaseOut:function(e,t,n,r){if((e/=r)<1/2.75){return n*7.5625*e*e+t}else if(e<2/2.75){return n*(7.5625*(e-=1.5/2.75)*e+.75)+t}else if(e<2.5/2.75){return n*(7.5625*(e-=2.25/2.75)*e+.9375)+t}else{return n*(7.5625*(e-=2.625/2.75)*e+.984375)+t}},BounceEaseIn:function(e,t,n,r){return n-Kinetic.Easings.BounceEaseOut(r-e,0,n,r)+t},BounceEaseInOut:function(e,t,n,r){if(e<r/2){return Kinetic.Easings.BounceEaseIn(e*2,0,n,r)*.5+t}else{return Kinetic.Easings.BounceEaseOut(e*2-r,0,n,r)*.5+n*.5+t}},EaseIn:function(e,t,n,r){return n*(e/=r)*e+t},EaseOut:function(e,t,n,r){return-n*(e/=r)*(e-2)+t},EaseInOut:function(e,t,n,r){if((e/=r/2)<1){return n/2*e*e+t}return-n/2*(--e*(e-2)-1)+t},StrongEaseIn:function(e,t,n,r){return n*(e/=r)*e*e*e*e+t},StrongEaseOut:function(e,t,n,r){return n*((e=e/r-1)*e*e*e*e+1)+t},StrongEaseInOut:function(e,t,n,r){if((e/=r/2)<1){return n/2*e*e*e*e*e+t}return n/2*((e-=2)*e*e*e*e+2)+t},Linear:function(e,t,n,r){return n*e/r+t}}})();(function(){Kinetic.DD={anim:new Kinetic.Animation,isDragging:false,offset:{x:0,y:0},node:null,_drag:function(e){var t=Kinetic.DD,n=t.node;if(n){if(!t.isDragging){var r=n.getStage().getPointerPosition();var i=n.dragDistance();var s=Math.max(Math.abs(r.x-t.startPointerPos.x),Math.abs(r.y-t.startPointerPos.y));if(s<i){return}}n._setDragPosition(e);if(!t.isDragging){t.isDragging=true;n.fire("dragstart",{type:"dragstart",target:n,evt:e},true)}n.fire("dragmove",{type:"dragmove",target:n,evt:e},true)}},_endDragBefore:function(e){var t=Kinetic.DD,n=t.node,r,i;if(n){r=n.nodeType;i=n.getLayer();t.anim.stop();if(t.isDragging){t.isDragging=false;Kinetic.listenClickTap=false;if(e){e.dragEndNode=n}}delete t.node;(i||n).draw()}},_endDragAfter:function(e){e=e||{};var t=e.dragEndNode;if(e&&t){t.fire("dragend",{type:"dragend",target:t,evt:e},true)}}};Kinetic.Node.prototype.startDrag=function(){var e=Kinetic.DD,t=this.getStage(),n=this.getLayer(),r=t.getPointerPosition(),i=this.getAbsolutePosition();if(r){if(e.node){e.node.stopDrag()}e.node=this;e.startPointerPos=r;e.offset.x=r.x-i.x;e.offset.y=r.y-i.y;e.anim.setLayers(n||this.getLayers());e.anim.start();this._setDragPosition()}};Kinetic.Node.prototype._setDragPosition=function(e){var t=Kinetic.DD,n=this.getStage().getPointerPosition(),r=this.getDragBoundFunc();if(!n){return}var i={x:n.x-t.offset.x,y:n.y-t.offset.y};if(r!==undefined){i=r.call(this,i,e)}this.setAbsolutePosition(i)};Kinetic.Node.prototype.stopDrag=function(){var e=Kinetic.DD,t={};e._endDragBefore(t);e._endDragAfter(t)};Kinetic.Node.prototype.setDraggable=function(e){this._setAttr("draggable",e);this._dragChange()};var e=Kinetic.Node.prototype.destroy;Kinetic.Node.prototype.destroy=function(){var t=Kinetic.DD;if(t.node&&t.node._id===this._id){this.stopDrag()}e.call(this)};Kinetic.Node.prototype.isDragging=function(){var e=Kinetic.DD;return e.node&&e.node._id===this._id&&e.isDragging};Kinetic.Node.prototype._listenDrag=function(){var e=this;this._dragCleanup();if(this.getClassName()==="Stage"){this.on("contentMousedown.kinetic contentTouchstart.kinetic",function(t){if(!Kinetic.DD.node){e.startDrag(t)}})}else{this.on("mousedown.kinetic touchstart.kinetic",function(t){if(!Kinetic.DD.node){e.startDrag(t)}})}};Kinetic.Node.prototype._dragChange=function(){if(this.attrs.draggable){this._listenDrag()}else{this._dragCleanup();var e=this.getStage();var t=Kinetic.DD;if(e&&t.node&&t.node._id===this._id){t.node.stopDrag()}}};Kinetic.Node.prototype._dragCleanup=function(){if(this.getClassName()==="Stage"){this.off("contentMousedown.kinetic");this.off("contentTouchstart.kinetic")}else{this.off("mousedown.kinetic");this.off("touchstart.kinetic")}};Kinetic.Factory.addGetterSetter(Kinetic.Node,"dragBoundFunc");Kinetic.Factory.addGetter(Kinetic.Node,"draggable",false);Kinetic.Factory.addOverloadedGetterSetter(Kinetic.Node,"draggable");var t=Kinetic.document.documentElement;t.addEventListener("mouseup",Kinetic.DD._endDragBefore,true);t.addEventListener("touchend",Kinetic.DD._endDragBefore,true);t.addEventListener("mouseup",Kinetic.DD._endDragAfter,false);t.addEventListener("touchend",Kinetic.DD._endDragAfter,false)})();(function(){Kinetic.Util.addMethods(Kinetic.Container,{__init:function(e){this.children=new Kinetic.Collection;Kinetic.Node.call(this,e)},getChildren:function(e){if(!e){return this.children}else{var t=new Kinetic.Collection;this.children.each(function(n){if(e(n)){t.push(n)}});return t}},hasChildren:function(){return this.getChildren().length>0},removeChildren:function(){var e=Kinetic.Collection.toCollection(this.children);var t;for(var n=0;n<e.length;n++){t=e[n];delete t.parent;t.index=0;if(t.hasChildren()){t.removeChildren()}t.remove()}e=null;this.children=new Kinetic.Collection;return this},destroyChildren:function(){var e=Kinetic.Collection.toCollection(this.children);var t;for(var n=0;n<e.length;n++){t=e[n];delete t.parent;t.index=0;t.destroy()}e=null;this.children=new Kinetic.Collection;return this},add:function(e){if(arguments.length>1){for(var t=0;t<arguments.length;t++){this.add(arguments[t])}return}if(e.getParent()){e.moveTo(this);return}var n=this.children;this._validateAdd(e);e.index=n.length;e.parent=this;n.push(e);this._fire("add",{child:e});return this},destroy:function(){if(this.hasChildren()){this.destroyChildren()}Kinetic.Node.prototype.destroy.call(this)},find:function(e){var t=[],n=e.replace(/ /g,"").split(","),r=n.length,i,s,o,u,a,f,l;for(i=0;i<r;i++){o=n[i];if(o.charAt(0)==="#"){a=this._getNodeById(o.slice(1));if(a){t.push(a)}}else if(o.charAt(0)==="."){u=this._getNodesByName(o.slice(1));t=t.concat(u)}else{f=this.getChildren();l=f.length;for(s=0;s<l;s++){t=t.concat(f[s]._get(o))}}}return Kinetic.Collection.toCollection(t)},_getNodeById:function(e){var t=Kinetic.ids[e];if(t!==undefined&&this.isAncestorOf(t)){return t}return null},_getNodesByName:function(e){var t=Kinetic.names[e]||[];return this._getDescendants(t)},_get:function(e){var t=Kinetic.Node.prototype._get.call(this,e);var n=this.getChildren();var r=n.length;for(var i=0;i<r;i++){t=t.concat(n[i]._get(e))}return t},toObject:function(){var e=Kinetic.Node.prototype.toObject.call(this);e.children=[];var t=this.getChildren();var n=t.length;for(var r=0;r<n;r++){var i=t[r];e.children.push(i.toObject())}return e},_getDescendants:function(e){var t=[];var n=e.length;for(var r=0;r<n;r++){var i=e[r];if(this.isAncestorOf(i)){t.push(i)}}return t},isAncestorOf:function(e){var t=e.getParent();while(t){if(t._id===this._id){return true}t=t.getParent()}return false},clone:function(e){var t=Kinetic.Node.prototype.clone.call(this,e);this.getChildren().each(function(e){t.add(e.clone())});return t},getAllIntersections:function(e){var t=[];this.find("Shape").each(function(n){if(n.isVisible()&&n.intersects(e)){t.push(n)}});return t},_setChildrenIndices:function(){this.children.each(function(e,t){e.index=t})},drawScene:function(e,t){var n=this.getLayer(),r=e||n&&n.getCanvas(),i=r&&r.getContext(),s=this._cache.canvas,o=s&&s.scene;if(this.isVisible()){if(o){this._drawCachedSceneCanvas(i)}else{this._drawChildren(r,"drawScene",t)}}return this},drawHit:function(e,t){var n=this.getLayer(),r=e||n&&n.hitCanvas,i=r&&r.getContext(),s=this._cache.canvas,o=s&&s.hit;if(this.shouldDrawHit()){if(o){this._drawCachedHitCanvas(i)}else{this._drawChildren(r,"drawHit",t)}}return this},_drawChildren:function(e,t,n){var r=this.getLayer(),i=e&&e.getContext(),s=this.getClipWidth(),o=this.getClipHeight(),u=s&&o,a,f;if(u&&r){a=this.getClipX();f=this.getClipY();i.save();r._applyTransform(this,i);i.beginPath();i.rect(a,f,s,o);i.clip();i.reset()}this.children.each(function(r){r[t](e,n)});if(u){i.restore()}}});Kinetic.Util.extend(Kinetic.Container,Kinetic.Node);Kinetic.Container.prototype.get=Kinetic.Container.prototype.find;Kinetic.Factory.addComponentsGetterSetter(Kinetic.Container,"clip",["x","y","width","height"]);Kinetic.Factory.addGetterSetter(Kinetic.Container,"clipX");Kinetic.Factory.addGetterSetter(Kinetic.Container,"clipY");Kinetic.Factory.addGetterSetter(Kinetic.Container,"clipWidth");Kinetic.Factory.addGetterSetter(Kinetic.Container,"clipHeight");Kinetic.Collection.mapMethods(Kinetic.Container)})();(function(){function t(e){e.fill()}function n(e){e.stroke()}function r(e){e.fill()}function i(e){e.stroke()}function s(){this._clearCache(e)}var e="hasShadow";Kinetic.Util.addMethods(Kinetic.Shape,{__init:function(e){this.nodeType="Shape";this._fillFunc=t;this._strokeFunc=n;this._fillFuncHit=r;this._strokeFuncHit=i;var o=Kinetic.shapes;var u;while(true){u=Kinetic.Util.getRandomColor();if(u&&!(u in o)){break}}this.colorKey=u;o[u]=this;Kinetic.Node.call(this,e);this.on("shadowColorChange.kinetic shadowBlurChange.kinetic shadowOffsetChange.kinetic shadowOpacityChange.kinetic shadowEnabledChange.kinetic",s)},hasChildren:function(){return false},getChildren:function(){return[]},getContext:function(){return this.getLayer().getContext()},getCanvas:function(){return this.getLayer().getCanvas()},hasShadow:function(){return this._getCache(e,this._hasShadow)},_hasShadow:function(){return this.getShadowEnabled()&&this.getShadowOpacity()!==0&&!!(this.getShadowColor()||this.getShadowBlur()||this.getShadowOffsetX()||this.getShadowOffsetY())},hasFill:function(){return!!(this.getFill()||this.getFillPatternImage()||this.getFillLinearGradientColorStops()||this.getFillRadialGradientColorStops())},hasStroke:function(){return!!(this.stroke()||this.strokeRed()||this.strokeGreen()||this.strokeBlue())},_get:function(e){return this.className===e||this.nodeType===e?[this]:[]},intersects:function(e){var t=this.getStage(),n=t.bufferHitCanvas,r;n.getContext().clear();this.drawScene(n);r=n.context.getImageData(Math.round(e.x),Math.round(e.y),1,1).data;return r[3]>0},destroy:function(){Kinetic.Node.prototype.destroy.call(this);delete Kinetic.shapes[this.colorKey]},_useBufferCanvas:function(){return(this.hasShadow()||this.getAbsoluteOpacity()!==1)&&this.hasFill()&&this.hasStroke()&&this.getStage()},drawScene:function(e,t){var n=this.getLayer(),r=e||n.getCanvas(),i=r.getContext(),s=this._cache.canvas,o=this.sceneFunc(),u=this.hasShadow(),a,f,l;if(this.isVisible()){if(s){this._drawCachedSceneCanvas(i)}else if(o){i.save();if(this._useBufferCanvas()){a=this.getStage();f=a.bufferCanvas;l=f.getContext();l.clear();l.save();l._applyLineJoin(this);n._applyTransform(this,l,t);o.call(this,l);l.restore();if(u){i.save();i._applyShadow(this);i.drawImage(f._canvas,0,0);i.restore()}i._applyOpacity(this);i.drawImage(f._canvas,0,0)}else{i._applyLineJoin(this);n._applyTransform(this,i,t);if(u){i.save();i._applyShadow(this);o.call(this,i);i.restore()}i._applyOpacity(this);o.call(this,i)}i.restore()}}return this},drawHit:function(e,t){var n=this.getLayer(),r=e||n.hitCanvas,i=r.getContext(),s=this.hitFunc()||this.sceneFunc(),o=this._cache.canvas,u=o&&o.hit;if(this.shouldDrawHit()){if(u){this._drawCachedHitCanvas(i)}else if(s){i.save();i._applyLineJoin(this);n._applyTransform(this,i,t);s.call(this,i);i.restore()}}return this},drawHitFromCache:function(e){var t=e||0,n=this._cache.canvas,r=this._getCachedSceneCanvas(),i=r.getContext(),s=n.hit,o=s.getContext(),u=r.getWidth(),a=r.getHeight(),f,l,c,h,p,d,v,m;o.clear();try{f=i.getImageData(0,0,u,a);l=f.data;c=o.getImageData(0,0,u,a);h=c.data;p=l.length;d=Kinetic.Util._hexToRgb(this.colorKey);for(v=0;v<p;v+=4){m=l[v+3];if(m>t){h[v]=d.r;h[v+1]=d.g;h[v+2]=d.b;h[v+3]=255}}o.putImageData(c,0,0)}catch(g){Kinetic.Util.warn("Unable to draw hit graph from cached scene canvas. "+g.message)}return this}});Kinetic.Util.extend(Kinetic.Shape,Kinetic.Node);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"stroke");Kinetic.Factory.addGetterSetter(Kinetic.Shape,"strokeRed",0,Kinetic.Validators.RGBComponent);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"strokeGreen",0,Kinetic.Validators.RGBComponent);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"strokeBlue",0,Kinetic.Validators.RGBComponent);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"strokeAlpha",1,Kinetic.Validators.alphaComponent);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"strokeWidth",2);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"lineJoin");Kinetic.Factory.addGetterSetter(Kinetic.Shape,"lineCap");Kinetic.Factory.addGetterSetter(Kinetic.Shape,"sceneFunc");Kinetic.Factory.addGetterSetter(Kinetic.Shape,"hitFunc");Kinetic.Factory.addGetterSetter(Kinetic.Shape,"dash");Kinetic.Factory.addGetterSetter(Kinetic.Shape,"shadowColor");Kinetic.Factory.addGetterSetter(Kinetic.Shape,"shadowRed",0,Kinetic.Validators.RGBComponent);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"shadowGreen",0,Kinetic.Validators.RGBComponent);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"shadowBlue",0,Kinetic.Validators.RGBComponent);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"shadowAlpha",1,Kinetic.Validators.alphaComponent);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"shadowBlur");Kinetic.Factory.addGetterSetter(Kinetic.Shape,"shadowOpacity");Kinetic.Factory.addComponentsGetterSetter(Kinetic.Shape,"shadowOffset",["x","y"]);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"shadowOffsetX",0);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"shadowOffsetY",0);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillPatternImage");Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fill");Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillRed",0,Kinetic.Validators.RGBComponent);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillGreen",0,Kinetic.Validators.RGBComponent);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillBlue",0,Kinetic.Validators.RGBComponent);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillAlpha",1,Kinetic.Validators.alphaComponent);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillPatternX",0);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillPatternY",0);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillLinearGradientColorStops");Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillRadialGradientStartRadius",0);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillRadialGradientEndRadius",0);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillRadialGradientColorStops");Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillPatternRepeat","repeat");Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillEnabled",true);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"strokeEnabled",true);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"shadowEnabled",true);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"dashEnabled",true);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"strokeScaleEnabled",true);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillPriority","color");Kinetic.Factory.addComponentsGetterSetter(Kinetic.Shape,"fillPatternOffset",["x","y"]);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillPatternOffsetX",0);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillPatternOffsetY",0);Kinetic.Factory.addComponentsGetterSetter(Kinetic.Shape,"fillPatternScale",["x","y"]);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillPatternScaleX",1);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillPatternScaleY",1);Kinetic.Factory.addComponentsGetterSetter(Kinetic.Shape,"fillLinearGradientStartPoint",["x","y"]);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillLinearGradientStartPointX",0);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillLinearGradientStartPointY",0);Kinetic.Factory.addComponentsGetterSetter(Kinetic.Shape,"fillLinearGradientEndPoint",["x","y"]);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillLinearGradientEndPointX",0);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillLinearGradientEndPointY",0);Kinetic.Factory.addComponentsGetterSetter(Kinetic.Shape,"fillRadialGradientStartPoint",["x","y"]);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillRadialGradientStartPointX",0);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillRadialGradientStartPointY",0);Kinetic.Factory.addComponentsGetterSetter(Kinetic.Shape,"fillRadialGradientEndPoint",["x","y"]);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillRadialGradientEndPointX",0);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillRadialGradientEndPointY",0);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillPatternRotation",0);Kinetic.Factory.backCompat(Kinetic.Shape,{dashArray:"dash",getDashArray:"getDash",setDashArray:"getDash",drawFunc:"sceneFunc",getDrawFunc:"getSceneFunc",setDrawFunc:"setSceneFunc",drawHitFunc:"hitFunc",getDrawHitFunc:"getHitFunc",setDrawHitFunc:"setHitFunc"});Kinetic.Collection.mapMethods(Kinetic.Shape)})();(function(){function R(e,t){e.content.addEventListener(t,function(n){e[B+t](n)},false)}var e="Stage",t="string",n="px",r="mouseout",i="mouseleave",s="mouseover",o="mouseenter",u="mousemove",a="mousedown",f="mouseup",l="click",c="dblclick",h="touchstart",p="touchend",d="tap",v="dbltap",m="touchmove",g="contentMouseout",y="contentMouseleave",b="contentMouseover",w="contentMouseenter",E="contentMousemove",S="contentMousedown",x="contentMouseup",T="contentClick",N="contentDblclick",C="contentTouchstart",k="contentTouchend",L="contentTap",A="contentDbltap",O="contentTouchmove",M="div",_="relative",D="inline-block",P="kineticjs-content",H=" ",B="_",j="container",F="",I=[a,u,f,r,h,m,p,s],q=I.length;Kinetic.Util.addMethods(Kinetic.Stage,{___init:function(t){this.nodeType=e;Kinetic.Container.call(this,t);this._id=Kinetic.idCounter++;this._buildDOM();this._bindContentEvents();this._enableNestedTransforms=false;Kinetic.stages.push(this)},_validateAdd:function(e){if(e.getType()!=="Layer"){Kinetic.Util.error("You may only add layers to the stage.")}},setContainer:function(e){if(typeof e===t){var n=e;e=Kinetic.document.getElementById(e);if(!e){throw"Can not find container in document with id "+n}}this._setAttr(j,e);return this},shouldDrawHit:function(){return true},draw:function(){Kinetic.Node.prototype.draw.call(this);return this},setHeight:function(e){Kinetic.Node.prototype.setHeight.call(this,e);this._resizeDOM();return this},setWidth:function(e){Kinetic.Node.prototype.setWidth.call(this,e);this._resizeDOM();return this},clear:function(){var e=this.children,t=e.length,n;for(n=0;n<t;n++){e[n].clear()}return this},clone:function(e){if(!e){e={}}e.container=Kinetic.document.createElement(M);return Kinetic.Container.prototype.clone.call(this,e)},destroy:function(){var e=this.content;Kinetic.Container.prototype.destroy.call(this);if(e&&Kinetic.Util._isInDocument(e)){this.getContainer().removeChild(e)}var t=Kinetic.stages.indexOf(this);if(t>-1){Kinetic.stages.splice(t,1)}},getPointerPosition:function(){return this.pointerPos},getStage:function(){return this},getContent:function(){return this.content},toDataURL:function(e){function a(r){var i=u[r],f=i.toDataURL(),l=new Kinetic.window.Image;l.onload=function(){o.drawImage(l,0,0);if(r<u.length-1){a(r+1)}else{e.callback(s.toDataURL(t,n))}};l.src=f}e=e||{};var t=e.mimeType||null,n=e.quality||null,r=e.x||0,i=e.y||0,s=new Kinetic.SceneCanvas({width:e.width||this.getWidth(),height:e.height||this.getHeight(),pixelRatio:1}),o=s.getContext()._context,u=this.children;if(r||i){o.translate(-1*r,-1*i)}a(0)},toImage:function(e){var t=e.callback;e.callback=function(e){Kinetic.Util._getImage(e,function(e){t(e)})};this.toDataURL(e)},getIntersection:function(e){var t=this.getChildren(),n=t.length,r=n-1,i,s;for(i=r;i>=0;i--){s=t[i].getIntersection(e);if(s){return s}}return null},_resizeDOM:function(){if(this.content){var e=this.getWidth(),t=this.getHeight(),r=this.getChildren(),i=r.length,s,o;this.content.style.width=e+n;this.content.style.height=t+n;this.bufferCanvas.setSize(e,t);this.bufferHitCanvas.setSize(e,t);for(s=0;s<i;s++){o=r[s];o.getCanvas().setSize(e,t);o.hitCanvas.setSize(e,t);o.draw()}}},add:function(e){if(arguments.length>1){for(var t=0;t<arguments.length;t++){this.add(arguments[t])}return}Kinetic.Container.prototype.add.call(this,e);e._setCanvasSize(this.width(),this.height());e.draw();this.content.appendChild(e.canvas._canvas);return this},getParent:function(){return null},getLayer:function(){return null},getLayers:function(){return this.getChildren()},_bindContentEvents:function(){for(var e=0;e<q;e++){R(this,I[e])}},_mouseover:function(e){if(!Kinetic.UA.mobile){this._setPointerPosition(e);this._fire(b,{evt:e})}},_mouseout:function(e){if(!Kinetic.UA.mobile){this._setPointerPosition(e);var t=this.targetShape;if(t&&!Kinetic.isDragging()){t._fireAndBubble(r,{evt:e});t._fireAndBubble(i,{evt:e});this.targetShape=null}this.pointerPos=undefined;this._fire(g,{evt:e})}},_mousemove:function(e){if(!Kinetic.UA.mobile){this._setPointerPosition(e);var t=Kinetic.DD,n=this.getIntersection(this.getPointerPosition());if(n&&n.isListening()){if(!Kinetic.isDragging()&&(!this.targetShape||this.targetShape._id!==n._id)){if(this.targetShape){this.targetShape._fireAndBubble(r,{evt:e},n);this.targetShape._fireAndBubble(i,{evt:e},n)}n._fireAndBubble(s,{evt:e},this.targetShape);n._fireAndBubble(o,{evt:e},this.targetShape);this.targetShape=n}else{n._fireAndBubble(u,{evt:e})}}else{if(this.targetShape&&!Kinetic.isDragging()){this.targetShape._fireAndBubble(r,{evt:e});this.targetShape._fireAndBubble(i,{evt:e});this.targetShape=null}}this._fire(E,{evt:e});if(t){t._drag(e)}}if(e.preventDefault){e.preventDefault()}},_mousedown:function(e){if(!Kinetic.UA.mobile){this._setPointerPosition(e);var t=this.getIntersection(this.getPointerPosition());Kinetic.listenClickTap=true;if(t&&t.isListening()){this.clickStartShape=t;t._fireAndBubble(a,{evt:e})}this._fire(S,{evt:e})}if(e.preventDefault){e.preventDefault()}},_mouseup:function(e){if(!Kinetic.UA.mobile){this._setPointerPosition(e);var t=this,n=this.getIntersection(this.getPointerPosition()),r=this.clickStartShape,i=false;if(Kinetic.inDblClickWindow){i=true;Kinetic.inDblClickWindow=false}else{Kinetic.inDblClickWindow=true}setTimeout(function(){Kinetic.inDblClickWindow=false},Kinetic.dblClickWindow);if(n&&n.isListening()){n._fireAndBubble(f,{evt:e});if(Kinetic.listenClickTap&&r&&r._id===n._id){n._fireAndBubble(l,{evt:e});if(i){n._fireAndBubble(c,{evt:e})}}}this._fire(x,{evt:e});if(Kinetic.listenClickTap){this._fire(T,{evt:e});if(i){this._fire(N,{evt:e})}}Kinetic.listenClickTap=false}if(e.preventDefault){e.preventDefault()}},_touchstart:function(e){this._setPointerPosition(e);var t=this.getIntersection(this.getPointerPosition());Kinetic.listenClickTap=true;if(t&&t.isListening()){this.tapStartShape=t;t._fireAndBubble(h,{evt:e});if(t.isListening()&&e.preventDefault){e.preventDefault()}}this._fire(C,{evt:e})},_touchend:function(e){this._setPointerPosition(e);var t=this.getIntersection(this.getPointerPosition()),n=false;if(Kinetic.inDblClickWindow){n=true;Kinetic.inDblClickWindow=false}else{Kinetic.inDblClickWindow=true}setTimeout(function(){Kinetic.inDblClickWindow=false},Kinetic.dblClickWindow);if(t&&t.isListening()){t._fireAndBubble(p,{evt:e});if(Kinetic.listenClickTap&&t._id===this.tapStartShape._id){t._fireAndBubble(d,{evt:e});if(n){t._fireAndBubble(v,{evt:e})}}if(t.isListening()&&e.preventDefault){e.preventDefault()}}if(Kinetic.listenClickTap){this._fire(k,{evt:e});if(n){this._fire(A,{evt:e})}}Kinetic.listenClickTap=false},_touchmove:function(e){this._setPointerPosition(e);var t=Kinetic.DD,n=this.getIntersection(this.getPointerPosition());if(n&&n.isListening()){n._fireAndBubble(m,{evt:e});if(n.isListening()&&e.preventDefault){e.preventDefault()}}this._fire(O,{evt:e});if(t){t._drag(e)}},_setPointerPosition:function(e){var t=this._getContentPosition(),n=e.offsetX,r=e.clientX,i=null,s=null,o;e=e?e:window.event;if(e.touches!==undefined){if(e.touches.length>0){o=e.touches[0];i=o.clientX-t.left;s=o.clientY-t.top}}else{if(n!==undefined){i=n;s=e.offsetY}else if(Kinetic.UA.browser==="mozilla"){i=e.layerX;s=e.layerY}else if(r!==undefined&&t){i=r-t.left;s=e.clientY-t.top}}if(i!==null&&s!==null){this.pointerPos={x:i,y:s}}},_getContentPosition:function(){var e=this.content.getBoundingClientRect?this.content.getBoundingClientRect():{top:0,left:0};return{top:e.top,left:e.left}},_buildDOM:function(){var e=this.getContainer();if(!e){if(Kinetic.Util.isBrowser()){throw"Stage has not container. But container is required"}else{e=Kinetic.document.createElement(M)}}e.innerHTML=F;this.content=Kinetic.document.createElement(M);this.content.style.position=_;this.content.style.display=D;this.content.className=P;this.content.setAttribute("role","presentation");e.appendChild(this.content);this.bufferCanvas=new Kinetic.SceneCanvas({pixelRatio:1});this.bufferHitCanvas=new Kinetic.HitCanvas;this._resizeDOM()},_onContent:function(e,t){var n=e.split(H),r=n.length,i,s;for(i=0;i<r;i++){s=n[i];this.content.addEventListener(s,t,false)}},cache:function(){Kinetic.Util.warn("Cache function is not allowed for stage. You may use cache only for layers, groups and shapes.");return},clearCache:function(){}});Kinetic.Util.extend(Kinetic.Stage,Kinetic.Container);Kinetic.Factory.addGetter(Kinetic.Stage,"container");Kinetic.Factory.addOverloadedGetterSetter(Kinetic.Stage,"container")})();(function(){Kinetic.Util.addMethods(Kinetic.BaseLayer,{___init:function(e){this.nodeType="Layer";Kinetic.Container.call(this,e)},createPNGStream:function(){return this.canvas._canvas.createPNGStream()},getCanvas:function(){return this.canvas},getHitCanvas:function(){return this.hitCanvas},getContext:function(){return this.getCanvas().getContext()},clear:function(e){this.getContext().clear(e);this.getHitCanvas().getContext().clear(e);return this},setZIndex:function(e){Kinetic.Node.prototype.setZIndex.call(this,e);var t=this.getStage();if(t){t.content.removeChild(this.getCanvas()._canvas);if(e<t.getChildren().length-1){t.content.insertBefore(this.getCanvas()._canvas,t.getChildren()[e+1].getCanvas()._canvas)}else{t.content.appendChild(this.getCanvas()._canvas)}}return this},moveToTop:function(){Kinetic.Node.prototype.moveToTop.call(this);var e=this.getStage();if(e){e.content.removeChild(this.getCanvas()._canvas);e.content.appendChild(this.getCanvas()._canvas)}},moveUp:function(){if(Kinetic.Node.prototype.moveUp.call(this)){var e=this.getStage();if(e){e.content.removeChild(this.getCanvas()._canvas);if(this.index<e.getChildren().length-1){e.content.insertBefore(this.getCanvas()._canvas,e.getChildren()[this.index+1].getCanvas()._canvas)}else{e.content.appendChild(this.getCanvas()._canvas)}}}},moveDown:function(){if(Kinetic.Node.prototype.moveDown.call(this)){var e=this.getStage();if(e){var t=e.getChildren();e.content.removeChild(this.getCanvas()._canvas);e.content.insertBefore(this.getCanvas()._canvas,t[this.index+1].getCanvas()._canvas)}}},moveToBottom:function(){if(Kinetic.Node.prototype.moveToBottom.call(this)){var e=this.getStage();if(e){var t=e.getChildren();e.content.removeChild(this.getCanvas()._canvas);e.content.insertBefore(this.getCanvas()._canvas,t[1].getCanvas()._canvas)}}},getLayer:function(){return this},remove:function(){var e=this.getCanvas()._canvas;Kinetic.Node.prototype.remove.call(this);if(e&&e.parentNode&&Kinetic.Util._isInDocument(e)){e.parentNode.removeChild(e)}return this},getStage:function(){return this.parent}});Kinetic.Util.extend(Kinetic.BaseLayer,Kinetic.Container);Kinetic.Factory.addGetterSetter(Kinetic.BaseLayer,"clearBeforeDraw",true);Kinetic.Collection.mapMethods(Kinetic.BaseLayer)})();(function(){var e="#",t="beforeDraw",n="draw",r=[{x:0,y:0},{x:-1,y:0},{x:-1,y:-1},{x:0,y:-1},{x:1,y:-1},{x:1,y:0},{x:1,y:1},{x:0,y:1},{x:-1,y:1}],i=r.length;Kinetic.Util.addMethods(Kinetic.Layer,{____init:function(e){this.nodeType="Layer";this.canvas=new Kinetic.SceneCanvas;this.hitCanvas=new Kinetic.HitCanvas;Kinetic.BaseLayer.call(this,e)},_setCanvasSize:function(e,t){this.canvas.setSize(e,t);this.hitCanvas.setSize(e,t)},_validateAdd:function(e){var t=e.getType();if(t!=="Group"&&t!=="Shape"){Kinetic.Util.error("You may only add groups and shapes to a layer.")}},getIntersection:function(e){var t,n,s,o;if(this.hitGraphEnabled()&&this.isVisible()){for(n=0;n<i;n++){s=r[n];t=this._getIntersection({x:e.x+s.x,y:e.y+s.y});o=t.shape;if(o){return o}else if(!t.antialiased){return null}}}else{return null}},_getIntersection:function(t){var n=this.hitCanvas.context._context.getImageData(t.x,t.y,1,1).data,r=n[3],i,s;if(r===255){i=Kinetic.Util._rgbToHex(n[0],n[1],n[2]);s=Kinetic.shapes[e+i];return{shape:s}}else if(r>0){return{antialiased:true}}else{return{}}},drawScene:function(e,r){var i=this.getLayer(),s=e||i&&i.getCanvas();this._fire(t,{node:this});if(this.getClearBeforeDraw()){s.getContext().clear()}Kinetic.Container.prototype.drawScene.call(this,s,r);this._fire(n,{node:this});return this},_applyTransform:function(e,t,n){var r=e.getAbsoluteTransform(n).getMatrix();t.transform(r[0],r[1],r[2],r[3],r[4],r[5])},drawHit:function(e,t){var n=this.getLayer(),r=e||n&&n.hitCanvas;if(n&&n.getClearBeforeDraw()){n.getHitCanvas().getContext().clear()}Kinetic.Container.prototype.drawHit.call(this,r,t);return this},clear:function(e){this.getContext().clear(e);this.getHitCanvas().getContext().clear(e);return this},setVisible:function(e){Kinetic.Node.prototype.setVisible.call(this,e);if(e){this.getCanvas()._canvas.style.display="block";this.hitCanvas._canvas.style.display="block"}else{this.getCanvas()._canvas.style.display="none";this.hitCanvas._canvas.style.display="none"}return this},enableHitGraph:function(){this.setHitGraphEnabled(true);return this},disableHitGraph:function(){this.setHitGraphEnabled(false);return this}});Kinetic.Util.extend(Kinetic.Layer,Kinetic.BaseLayer);Kinetic.Factory.addGetterSetter(Kinetic.Layer,"hitGraphEnabled",true);Kinetic.Collection.mapMethods(Kinetic.Layer)})();(function(){var e="#",t="beforeDraw",n="draw";Kinetic.Util.addMethods(Kinetic.FastLayer,{____init:function(e){this.nodeType="Layer";this.canvas=new Kinetic.SceneCanvas;Kinetic.BaseLayer.call(this,e)},_validateAdd:function(e){var t=e.getType();if(t!=="Shape"){Kinetic.Util.error("You may only add shapes to a fast layer.")}},_setCanvasSize:function(e,t){this.canvas.setSize(e,t)},hitGraphEnabled:function(){return false},getIntersection:function(){return null},drawScene:function(e){var t=this.getLayer(),n=e||t&&t.getCanvas();if(this.getClearBeforeDraw()){n.getContext().clear()}Kinetic.Container.prototype.drawScene.call(this,n);return this},_applyTransform:function(e,t,n){if(!n||n._id!==this._id){var r=e.getTransform().getMatrix();t.transform(r[0],r[1],r[2],r[3],r[4],r[5])}},draw:function(){this.drawScene();return this},clear:function(e){this.getContext().clear(e);return this},setVisible:function(e){Kinetic.Node.prototype.setVisible.call(this,e);if(e){this.getCanvas()._canvas.style.display="block"}else{this.getCanvas()._canvas.style.display="none"}return this}});Kinetic.Util.extend(Kinetic.FastLayer,Kinetic.BaseLayer);Kinetic.Collection.mapMethods(Kinetic.FastLayer)})();(function(){Kinetic.Util.addMethods(Kinetic.Group,{___init:function(e){this.nodeType="Group";Kinetic.Container.call(this,e)},_validateAdd:function(e){var t=e.getType();if(t!=="Group"&&t!=="Shape"){Kinetic.Util.error("You may only add groups and shapes to groups.")}}});Kinetic.Util.extend(Kinetic.Group,Kinetic.Container);Kinetic.Collection.mapMethods(Kinetic.Group)})();(function(){Kinetic.Rect=function(e){this.___init(e)};Kinetic.Rect.prototype={___init:function(e){Kinetic.Shape.call(this,e);this.className="Rect";this.sceneFunc(this._sceneFunc)},_sceneFunc:function(e){var t=this.getCornerRadius(),n=this.getWidth(),r=this.getHeight();e.beginPath();if(!t){e.rect(0,0,n,r)}else{e.moveTo(t,0);e.lineTo(n-t,0);e.arc(n-t,t,t,Math.PI*3/2,0,false);e.lineTo(n,r-t);e.arc(n-t,r-t,t,0,Math.PI/2,false);e.lineTo(t,r);e.arc(t,r-t,t,Math.PI/2,Math.PI,false);e.lineTo(0,t);e.arc(t,t,t,Math.PI,Math.PI*3/2,false)}e.closePath();e.fillStrokeShape(this)}};Kinetic.Util.extend(Kinetic.Rect,Kinetic.Shape);Kinetic.Factory.addGetterSetter(Kinetic.Rect,"cornerRadius",0);Kinetic.Collection.mapMethods(Kinetic.Rect)})();(function(){var e=Math.PI*2-1e-4,t="Circle";Kinetic.Circle=function(e){this.___init(e)};Kinetic.Circle.prototype={___init:function(e){Kinetic.Shape.call(this,e);this.className=t;this.sceneFunc(this._sceneFunc)},_sceneFunc:function(t){t.beginPath();t.arc(0,0,this.getRadius(),0,e,false);t.closePath();t.fillStrokeShape(this)},getWidth:function(){return this.getRadius()*2},getHeight:function(){return this.getRadius()*2},setWidth:function(e){Kinetic.Node.prototype.setWidth.call(this,e);this.setRadius(e/2)},setHeight:function(e){Kinetic.Node.prototype.setHeight.call(this,e);this.setRadius(e/2)}};Kinetic.Util.extend(Kinetic.Circle,Kinetic.Shape);Kinetic.Factory.addGetterSetter(Kinetic.Circle,"radius",0);Kinetic.Collection.mapMethods(Kinetic.Circle)})();(function(){var e=Math.PI*2-1e-4,t="Ellipse";Kinetic.Ellipse=function(e){this.___init(e)};Kinetic.Ellipse.prototype={___init:function(e){Kinetic.Shape.call(this,e);this.className=t;this.sceneFunc(this._sceneFunc)},_sceneFunc:function(t){var n=this.getRadius(),r=n.x,i=n.y;t.beginPath();t.save();if(r!==i){t.scale(1,i/r)}t.arc(0,0,r,0,e,false);t.restore();t.closePath();t.fillStrokeShape(this)},getWidth:function(){return this.getRadius().x*2},getHeight:function(){return this.getRadius().y*2},setWidth:function(e){Kinetic.Node.prototype.setWidth.call(this,e);this.setRadius({x:e/2})},setHeight:function(e){Kinetic.Node.prototype.setHeight.call(this,e);this.setRadius({y:e/2})}};Kinetic.Util.extend(Kinetic.Ellipse,Kinetic.Shape);Kinetic.Factory.addComponentsGetterSetter(Kinetic.Ellipse,"radius",["x","y"]);Kinetic.Factory.addGetterSetter(Kinetic.Ellipse,"radiusX",0);Kinetic.Factory.addGetterSetter(Kinetic.Ellipse,"radiusY",0);Kinetic.Collection.mapMethods(Kinetic.Ellipse)})();(function(){var e=Math.PI*2-1e-4;Kinetic.Ring=function(e){this.___init(e)};Kinetic.Ring.prototype={___init:function(e){Kinetic.Shape.call(this,e);this.className="Ring";this.sceneFunc(this._sceneFunc)},_sceneFunc:function(t){t.beginPath();t.arc(0,0,this.getInnerRadius(),0,e,false);t.moveTo(this.getOuterRadius(),0);t.arc(0,0,this.getOuterRadius(),e,0,true);t.closePath();t.fillStrokeShape(this)},getWidth:function(){return this.getOuterRadius()*2},getHeight:function(){return this.getOuterRadius()*2},setWidth:function(e){Kinetic.Node.prototype.setWidth.call(this,e);this.setOuterRadius(e/2)},setHeight:function(e){Kinetic.Node.prototype.setHeight.call(this,e);this.setOuterRadius(e/2)}};Kinetic.Util.extend(Kinetic.Ring,Kinetic.Shape);Kinetic.Factory.addGetterSetter(Kinetic.Ring,"innerRadius",0);Kinetic.Factory.addGetterSetter(Kinetic.Ring,"outerRadius",0);Kinetic.Collection.mapMethods(Kinetic.Ring)})();(function(){Kinetic.Wedge=function(e){this.___init(e)};Kinetic.Wedge.prototype={___init:function(e){Kinetic.Shape.call(this,e);this.className="Wedge";this.sceneFunc(this._sceneFunc)},_sceneFunc:function(e){e.beginPath();e.arc(0,0,this.getRadius(),0,Kinetic.getAngle(this.getAngle()),this.getClockwise());e.lineTo(0,0);e.closePath();e.fillStrokeShape(this)}};Kinetic.Util.extend(Kinetic.Wedge,Kinetic.Shape);Kinetic.Factory.addGetterSetter(Kinetic.Wedge,"radius",0);Kinetic.Factory.addGetterSetter(Kinetic.Wedge,"angle",0);Kinetic.Factory.addGetterSetter(Kinetic.Wedge,"clockwise",false);Kinetic.Factory.backCompat(Kinetic.Wedge,{angleDeg:"angle",getAngleDeg:"getAngle",setAngleDeg:"setAngle"});Kinetic.Collection.mapMethods(Kinetic.Wedge)})();(function(){var e=Math.PI/180;Kinetic.Arc=function(e){this.___init(e)};Kinetic.Arc.prototype={___init:function(e){Kinetic.Shape.call(this,e);this.className="Arc";this.sceneFunc(this._sceneFunc)},_sceneFunc:function(e){var t=Kinetic.getAngle(this.angle()),n=this.clockwise();e.beginPath();e.arc(0,0,this.getOuterRadius(),0,t,n);e.arc(0,0,this.getInnerRadius(),t,0,!n);e.closePath();e.fillStrokeShape(this)}};Kinetic.Util.extend(Kinetic.Arc,Kinetic.Shape);Kinetic.Factory.addGetterSetter(Kinetic.Arc,"innerRadius",0);Kinetic.Factory.addGetterSetter(Kinetic.Arc,"outerRadius",0);Kinetic.Factory.addGetterSetter(Kinetic.Arc,"angle",0);Kinetic.Factory.addGetterSetter(Kinetic.Arc,"clockwise",false);Kinetic.Collection.mapMethods(Kinetic.Arc)})();(function(){var e="Image";Kinetic.Image=function(e){this.___init(e)};Kinetic.Image.prototype={___init:function(t){Kinetic.Shape.call(this,t);this.className=e;this.sceneFunc(this._sceneFunc);this.hitFunc(this._hitFunc)},_useBufferCanvas:function(){return(this.hasShadow()||this.getAbsoluteOpacity()!==1)&&this.hasStroke()},_sceneFunc:function(e){var t=this.getWidth(),n=this.getHeight(),r=this.getImage(),i,s,o,u;if(r){i=this.getCrop();s=i.width;o=i.height;if(s&&o){u=[r,i.x,i.y,s,o,0,0,t,n]}else{u=[r,0,0,t,n]}}e.beginPath();e.rect(0,0,t,n);e.closePath();e.fillStrokeShape(this);if(r){e.drawImage.apply(e,u)}},_hitFunc:function(e){var t=this.getWidth(),n=this.getHeight();e.beginPath();e.rect(0,0,t,n);e.closePath();e.fillStrokeShape(this)},getWidth:function(){var e=this.getImage();return this.attrs.width||(e?e.width:0)},getHeight:function(){var e=this.getImage();return this.attrs.height||(e?e.height:0)}};Kinetic.Util.extend(Kinetic.Image,Kinetic.Shape);Kinetic.Factory.addGetterSetter(Kinetic.Image,"image");Kinetic.Factory.addComponentsGetterSetter(Kinetic.Image,"crop",["x","y","width","height"]);Kinetic.Factory.addGetterSetter(Kinetic.Image,"cropX",0);Kinetic.Factory.addGetterSetter(Kinetic.Image,"cropY",0);Kinetic.Factory.addGetterSetter(Kinetic.Image,"cropWidth",0);Kinetic.Factory.addGetterSetter(Kinetic.Image,"cropHeight",0);Kinetic.Collection.mapMethods(Kinetic.Image)})();(function(){function w(e){e.fillText(this.partialText,0,0)}function E(e){e.strokeText(this.partialText,0,0)}var e="auto",t="center",n="Change.kinetic",r="2d",i="-",s="",o="left",u="text",a="Text",f="middle",l="normal",c="px ",h=" ",p="right",d="word",v="char",m="none",g=["fontFamily","fontSize","fontStyle","fontVariant","padding","align","lineHeight","text","width","height","wrap"],y=g.length,b=Kinetic.Util.createCanvasElement().getContext(r);Kinetic.Text=function(e){this.___init(e)};Kinetic.Text.prototype={___init:function(t){var r=this;if(t.width===undefined){t.width=e}if(t.height===undefined){t.height=e}Kinetic.Shape.call(this,t);this._fillFunc=w;this._strokeFunc=E;this.className=a;for(var i=0;i<y;i++){this.on(g[i]+n,r._setTextData)}this._setTextData();this.sceneFunc(this._sceneFunc);this.hitFunc(this._hitFunc)},_sceneFunc:function(e){var n=this.getPadding(),r=this.getTextHeight(),i=this.getLineHeight()*r,s=this.textArr,u=s.length,a=this.getWidth(),l;e.setAttr("font",this._getContextFont());e.setAttr("textBaseline",f);e.setAttr("textAlign",o);e.save();e.translate(n,0);e.translate(0,n+r/2);for(l=0;l<u;l++){var c=s[l],h=c.text,d=c.width;e.save();if(this.getAlign()===p){e.translate(a-d-n*2,0)}else if(this.getAlign()===t){e.translate((a-d-n*2)/2,0)}this.partialText=h;e.fillStrokeShape(this);e.restore();e.translate(0,i)}e.restore()},_hitFunc:function(e){var t=this.getWidth(),n=this.getHeight();e.beginPath();e.rect(0,0,t,n);e.closePath();e.fillStrokeShape(this)},setText:function(e){var t=Kinetic.Util._isString(e)?e:e.toString();this._setAttr(u,t);return this},getWidth:function(){return this.attrs.width===e?this.getTextWidth()+this.getPadding()*2:this.attrs.width},getHeight:function(){return this.attrs.height===e?this.getTextHeight()*this.textArr.length*this.getLineHeight()+this.getPadding()*2:this.attrs.height},getTextWidth:function(){return this.textWidth},getTextHeight:function(){return this.textHeight},_getTextSize:function(e){var t=b,n=this.getFontSize(),r;t.save();t.font=this._getContextFont();r=t.measureText(e);t.restore();return{width:r.width,height:parseInt(n,10)}},_getContextFont:function(){return this.getFontStyle()+h+this.getFontVariant()+h+this.getFontSize()+c+this.getFontFamily()},_addTextLine:function(e,t){return this.textArr.push({text:e,width:t})},_getTextWidth:function(e){return b.measureText(e).width},_setTextData:function(){var t=this.getText().split("\n"),n=+this.getFontSize(),r=0,s=this.getLineHeight()*n,o=this.attrs.width,u=this.attrs.height,a=o!==e,f=u!==e,l=this.getPadding(),c=o-l*2,p=u-l*2,d=0,g=this.getWrap(),y=g!==m,w=g!==v&&y;this.textArr=[];b.save();b.font=this._getContextFont();for(var E=0,S=t.length;E<S;++E){var x=t[E],T=this._getTextWidth(x);if(a&&T>c){while(x.length>0){var N=0,C=x.length,k="",L=0;while(N<C){var A=N+C>>>1,O=x.slice(0,A+1),M=this._getTextWidth(O);if(M<=c){N=A+1;k=O;L=M}else{C=A}}if(k){if(w){var _=Math.max(k.lastIndexOf(h),k.lastIndexOf(i))+1;if(_>0){N=_;k=k.slice(0,N);L=this._getTextWidth(k)}}this._addTextLine(k,L);r=Math.max(r,L);d+=s;if(!y||f&&d+s>p){break}x=x.slice(N);if(x.length>0){T=this._getTextWidth(x);if(T<=c){this._addTextLine(x,T);d+=s;r=Math.max(r,T);break}}}else{break}}}else{this._addTextLine(x,T);d+=s;r=Math.max(r,T)}if(f&&d+s>p){break}}b.restore();this.textHeight=n;this.textWidth=r}};Kinetic.Util.extend(Kinetic.Text,Kinetic.Shape);Kinetic.Factory.addGetterSetter(Kinetic.Text,"fontFamily","Arial");Kinetic.Factory.addGetterSetter(Kinetic.Text,"fontSize",12);Kinetic.Factory.addGetterSetter(Kinetic.Text,"fontStyle",l);Kinetic.Factory.addGetterSetter(Kinetic.Text,"fontVariant",l);Kinetic.Factory.addGetterSetter(Kinetic.Text,"padding",0);Kinetic.Factory.addGetterSetter(Kinetic.Text,"align",o);Kinetic.Factory.addGetterSetter(Kinetic.Text,"lineHeight",1);Kinetic.Factory.addGetterSetter(Kinetic.Text,"wrap",d);Kinetic.Factory.addGetter(Kinetic.Text,"text",s);Kinetic.Factory.addOverloadedGetterSetter(Kinetic.Text,"text");Kinetic.Collection.mapMethods(Kinetic.Text)})();(function(){Kinetic.Line=function(e){this.___init(e)};Kinetic.Line.prototype={___init:function(e){Kinetic.Shape.call(this,e);this.className="Line";this.on("pointsChange.kinetic tensionChange.kinetic closedChange.kinetic",function(){this._clearCache("tensionPoints")});this.sceneFunc(this._sceneFunc)},_sceneFunc:function(e){var t=this.getPoints(),n=t.length,r=this.getTension(),i=this.getClosed(),s,o,u;e.beginPath();e.moveTo(t[0],t[1]);if(r!==0&&n>4){s=this.getTensionPoints();o=s.length;u=i?0:4;if(!i){e.quadraticCurveTo(s[0],s[1],s[2],s[3])}while(u<o-2){e.bezierCurveTo(s[u++],s[u++],s[u++],s[u++],s[u++],s[u++])}if(!i){e.quadraticCurveTo(s[o-2],s[o-1],t[n-2],t[n-1])}}else{for(u=2;u<n;u+=2){e.lineTo(t[u],t[u+1])}}if(i){e.closePath();e.fillStrokeShape(this)}else{e.strokeShape(this)}},getTensionPoints:function(){return this._getCache("tensionPoints",this._getTensionPoints)},_getTensionPoints:function(){if(this.getClosed()){return this._getTensionPointsClosed()}else{return Kinetic.Util._expandPoints(this.getPoints(),this.getTension())}},_getTensionPointsClosed:function(){var e=this.getPoints(),t=e.length,n=this.getTension(),r=Kinetic.Util,i=r._getControlPoints(e[t-2],e[t-1],e[0],e[1],e[2],e[3],n),s=r._getControlPoints(e[t-4],e[t-3],e[t-2],e[t-1],e[0],e[1],n),o=Kinetic.Util._expandPoints(e,n),u=[i[2],i[3]].concat(o).concat([s[0],s[1],e[t-2],e[t-1],s[2],s[3],i[0],i[1],e[0],e[1]]);return u}};Kinetic.Util.extend(Kinetic.Line,Kinetic.Shape);Kinetic.Factory.addGetterSetter(Kinetic.Line,"closed",false);Kinetic.Factory.addGetterSetter(Kinetic.Line,"tension",0);Kinetic.Factory.addGetterSetter(Kinetic.Line,"points");Kinetic.Collection.mapMethods(Kinetic.Line)})();(function(){Kinetic.Sprite=function(e){this.___init(e)};Kinetic.Sprite.prototype={___init:function(e){Kinetic.Shape.call(this,e);this.className="Sprite";this.anim=new Kinetic.Animation;this.on("animationChange.kinetic",function(){this.frameIndex(0)});this.on("frameRateChange.kinetic",function(){if(!this.anim.isRunning()){return}clearInterval(this.interval);this._setInterval()});this.sceneFunc(this._sceneFunc);this.hitFunc(this._hitFunc)},_sceneFunc:function(e){var t=this.getAnimation(),n=this.frameIndex(),r=n*4,i=this.getAnimations()[t],s=i[r+0],o=i[r+1],u=i[r+2],a=i[r+3],f=this.getImage();if(f){e.drawImage(f,s,o,u,a,0,0,u,a)}},_hitFunc:function(e){var t=this.getAnimation(),n=this.frameIndex(),r=n*4,i=this.getAnimations()[t],s=i[r+2],o=i[r+3];e.beginPath();e.rect(0,0,s,o);e.closePath();e.fillShape(this)},_useBufferCanvas:function(){return(this.hasShadow()||this.getAbsoluteOpacity()!==1)&&this.hasStroke()},_setInterval:function(){var e=this;this.interval=setInterval(function(){e._updateIndex()},1e3/this.getFrameRate())},start:function(){var e=this.getLayer();this.anim.setLayers(e);this._setInterval();this.anim.start()},stop:function(){this.anim.stop();clearInterval(this.interval)},isRunning:function(){return this.anim.isRunning()},_updateIndex:function(){var e=this.frameIndex(),t=this.getAnimation(),n=this.getAnimations(),r=n[t],i=r.length/4;if(e<i-1){this.frameIndex(e+1)}else{this.frameIndex(0)}}};Kinetic.Util.extend(Kinetic.Sprite,Kinetic.Shape);Kinetic.Factory.addGetterSetter(Kinetic.Sprite,"animation");Kinetic.Factory.addGetterSetter(Kinetic.Sprite,"animations");Kinetic.Factory.addGetterSetter(Kinetic.Sprite,"image");Kinetic.Factory.addGetterSetter(Kinetic.Sprite,"frameIndex",0);Kinetic.Factory.addGetterSetter(Kinetic.Sprite,"frameRate",17);Kinetic.Factory.backCompat(Kinetic.Sprite,{index:"frameIndex",getIndex:"getFrameIndex",setIndex:"setFrameIndex"});Kinetic.Collection.mapMethods(Kinetic.Sprite)})();(function(){Kinetic.Path=function(e){this.___init(e)};Kinetic.Path.prototype={___init:function(e){this.dataArray=[];var t=this;Kinetic.Shape.call(this,e);this.className="Path";this.dataArray=Kinetic.Path.parsePathData(this.getData());this.on("dataChange.kinetic",function(){t.dataArray=Kinetic.Path.parsePathData(this.getData())});this.sceneFunc(this._sceneFunc)},_sceneFunc:function(e){var t=this.dataArray,n=false;e.beginPath();for(var r=0;r<t.length;r++){var i=t[r].command;var s=t[r].points;switch(i){case"L":e.lineTo(s[0],s[1]);break;case"M":e.moveTo(s[0],s[1]);break;case"C":e.bezierCurveTo(s[0],s[1],s[2],s[3],s[4],s[5]);break;case"Q":e.quadraticCurveTo(s[0],s[1],s[2],s[3]);break;case"A":var o=s[0],u=s[1],a=s[2],f=s[3],l=s[4],c=s[5],h=s[6],p=s[7];var d=a>f?a:f;var v=a>f?1:a/f;var m=a>f?f/a:1;e.translate(o,u);e.rotate(h);e.scale(v,m);e.arc(0,0,d,l,l+c,1-p);e.scale(1/v,1/m);e.rotate(-h);e.translate(-o,-u);break;case"z":e.closePath();n=true;break}}if(n){e.fillStrokeShape(this)}else{e.strokeShape(this)}}};Kinetic.Util.extend(Kinetic.Path,Kinetic.Shape);Kinetic.Path.getLineLength=function(e,t,n,r){return Math.sqrt((n-e)*(n-e)+(r-t)*(r-t))};Kinetic.Path.getPointOnLine=function(e,t,n,r,i,s,o){if(s===undefined){s=t}if(o===undefined){o=n}var u=(i-n)/(r-t+1e-8);var a=Math.sqrt(e*e/(1+u*u));if(r<t){a*=-1}var f=u*a;var l;if(r===t){l={x:s,y:o+f}}else if((o-n)/(s-t+1e-8)===u){l={x:s+a,y:o+f}}else{var c,h;var p=this.getLineLength(t,n,r,i);if(p<1e-8){return undefined}var d=(s-t)*(r-t)+(o-n)*(i-n);d=d/(p*p);c=t+d*(r-t);h=n+d*(i-n);var v=this.getLineLength(s,o,c,h);var m=Math.sqrt(e*e-v*v);a=Math.sqrt(m*m/(1+u*u));if(r<t){a*=-1}f=u*a;l={x:c+a,y:h+f}}return l};Kinetic.Path.getPointOnCubicBezier=function(e,t,n,r,i,s,o,u,a){function f(e){return e*e*e}function l(e){return 3*e*e*(1-e)}function c(e){return 3*e*(1-e)*(1-e)}function h(e){return(1-e)*(1-e)*(1-e)}var p=u*f(e)+s*l(e)+r*c(e)+t*h(e);var d=a*f(e)+o*l(e)+i*c(e)+n*h(e);return{x:p,y:d}};Kinetic.Path.getPointOnQuadraticBezier=function(e,t,n,r,i,s,o){function u(e){return e*e}function a(e){return 2*e*(1-e)}function f(e){return(1-e)*(1-e)}var l=s*u(e)+r*a(e)+t*f(e);var c=o*u(e)+i*a(e)+n*f(e);return{x:l,y:c}};Kinetic.Path.getPointOnEllipticalArc=function(e,t,n,r,i,s){var o=Math.cos(s),u=Math.sin(s);var a={x:n*Math.cos(i),y:r*Math.sin(i)};return{x:e+(a.x*o-a.y*u),y:t+(a.x*u+a.y*o)}};Kinetic.Path.parsePathData=function(e){if(!e){return[]}var t=e;var n=["m","M","l","L","v","V","h","H","z","Z","c","C","q","Q","t","T","s","S","a","A"];t=t.replace(new RegExp(" ","g"),",");for(var r=0;r<n.length;r++){t=t.replace(new RegExp(n[r],"g"),"|"+n[r])}var i=t.split("|");var s=[];var o=0;var u=0;for(r=1;r<i.length;r++){var a=i[r];var f=a.charAt(0);a=a.slice(1);a=a.replace(new RegExp(",-","g"),"-");a=a.replace(new RegExp("-","g"),",-");a=a.replace(new RegExp("e,-","g"),"e-");var l=a.split(",");if(l.length>0&&l[0]===""){l.shift()}for(var c=0;c<l.length;c++){l[c]=parseFloat(l[c])}while(l.length>0){if(isNaN(l[0])){break}var h=null;var p=[];var d=o,v=u;var m,g,y;var b,w,E,S,x,T,N;switch(f){case"l":o+=l.shift();u+=l.shift();h="L";p.push(o,u);break;case"L":o=l.shift();u=l.shift();p.push(o,u);break;case"m":var C=l.shift();var k=l.shift();o+=C;u+=k;h="M";if(s.length>2&&s[s.length-1].command==="z"){for(var L=s.length-2;L>=0;L--){if(s[L].command==="M"){o=s[L].points[0]+C;u=s[L].points[1]+k;break}}}p.push(o,u);f="l";break;case"M":o=l.shift();u=l.shift();h="M";p.push(o,u);f="L";break;case"h":o+=l.shift();h="L";p.push(o,u);break;case"H":o=l.shift();h="L";p.push(o,u);break;case"v":u+=l.shift();h="L";p.push(o,u);break;case"V":u=l.shift();h="L";p.push(o,u);break;case"C":p.push(l.shift(),l.shift(),l.shift(),l.shift());o=l.shift();u=l.shift();p.push(o,u);break;case"c":p.push(o+l.shift(),u+l.shift(),o+l.shift(),u+l.shift());o+=l.shift();u+=l.shift();h="C";p.push(o,u);break;case"S":g=o;y=u;m=s[s.length-1];if(m.command==="C"){g=o+(o-m.points[2]);y=u+(u-m.points[3])}p.push(g,y,l.shift(),l.shift());o=l.shift();u=l.shift();h="C";p.push(o,u);break;case"s":g=o;y=u;m=s[s.length-1];if(m.command==="C"){g=o+(o-m.points[2]);y=u+(u-m.points[3])}p.push(g,y,o+l.shift(),u+l.shift());o+=l.shift();u+=l.shift();h="C";p.push(o,u);break;case"Q":p.push(l.shift(),l.shift());o=l.shift();u=l.shift();p.push(o,u);break;case"q":p.push(o+l.shift(),u+l.shift());o+=l.shift();u+=l.shift();h="Q";p.push(o,u);break;case"T":g=o;y=u;m=s[s.length-1];if(m.command==="Q"){g=o+(o-m.points[0]);y=u+(u-m.points[1])}o=l.shift();u=l.shift();h="Q";p.push(g,y,o,u);break;case"t":g=o;y=u;m=s[s.length-1];if(m.command==="Q"){g=o+(o-m.points[0]);y=u+(u-m.points[1])}o+=l.shift();u+=l.shift();h="Q";p.push(g,y,o,u);break;case"A":b=l.shift();w=l.shift();E=l.shift();S=l.shift();x=l.shift();T=o;N=u;o=l.shift();u=l.shift();h="A";p=this.convertEndpointToCenterParameterization(T,N,o,u,S,x,b,w,E);break;case"a":b=l.shift();w=l.shift();E=l.shift();S=l.shift();x=l.shift();T=o;N=u;o+=l.shift();u+=l.shift();h="A";p=this.convertEndpointToCenterParameterization(T,N,o,u,S,x,b,w,E);break}s.push({command:h||f,points:p,start:{x:d,y:v},pathLength:this.calcLength(d,v,h||f,p)})}if(f==="z"||f==="Z"){s.push({command:"z",points:[],start:undefined,pathLength:0})}}return s};Kinetic.Path.calcLength=function(e,t,n,r){var i,s,o,u;var a=Kinetic.Path;switch(n){case"L":return a.getLineLength(e,t,r[0],r[1]);case"C":i=0;s=a.getPointOnCubicBezier(0,e,t,r[0],r[1],r[2],r[3],r[4],r[5]);for(u=.01;u<=1;u+=.01){o=a.getPointOnCubicBezier(u,e,t,r[0],r[1],r[2],r[3],r[4],r[5]);i+=a.getLineLength(s.x,s.y,o.x,o.y);s=o}return i;case"Q":i=0;s=a.getPointOnQuadraticBezier(0,e,t,r[0],r[1],r[2],r[3]);for(u=.01;u<=1;u+=.01){o=a.getPointOnQuadraticBezier(u,e,t,r[0],r[1],r[2],r[3]);i+=a.getLineLength(s.x,s.y,o.x,o.y);s=o}return i;case"A":i=0;var f=r[4];var l=r[5];var c=r[4]+l;var h=Math.PI/180;if(Math.abs(f-c)<h){h=Math.abs(f-c)}s=a.getPointOnEllipticalArc(r[0],r[1],r[2],r[3],f,0);if(l<0){for(u=f-h;u>c;u-=h){o=a.getPointOnEllipticalArc(r[0],r[1],r[2],r[3],u,0);i+=a.getLineLength(s.x,s.y,o.x,o.y);s=o}}else{for(u=f+h;u<c;u+=h){o=a.getPointOnEllipticalArc(r[0],r[1],r[2],r[3],u,0);i+=a.getLineLength(s.x,s.y,o.x,o.y);s=o}}o=a.getPointOnEllipticalArc(r[0],r[1],r[2],r[3],c,0);i+=a.getLineLength(s.x,s.y,o.x,o.y);return i}return 0};Kinetic.Path.convertEndpointToCenterParameterization=function(e,t,n,r,i,s,o,u,a){var f=a*(Math.PI/180);var l=Math.cos(f)*(e-n)/2+Math.sin(f)*(t-r)/2;var c=-1*Math.sin(f)*(e-n)/2+Math.cos(f)*(t-r)/2;var h=l*l/(o*o)+c*c/(u*u);if(h>1){o*=Math.sqrt(h);u*=Math.sqrt(h)}var p=Math.sqrt((o*o*u*u-o*o*c*c-u*u*l*l)/(o*o*c*c+u*u*l*l));if(i===s){p*=-1}if(isNaN(p)){p=0}var d=p*o*c/u;var v=p*-u*l/o;var m=(e+n)/2+Math.cos(f)*d-Math.sin(f)*v;var g=(t+r)/2+Math.sin(f)*d+Math.cos(f)*v;var y=function(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])};var b=function(e,t){return(e[0]*t[0]+e[1]*t[1])/(y(e)*y(t))};var w=function(e,t){return(e[0]*t[1]<e[1]*t[0]?-1:1)*Math.acos(b(e,t))};var E=w([1,0],[(l-d)/o,(c-v)/u]);var S=[(l-d)/o,(c-v)/u];var x=[(-1*l-d)/o,(-1*c-v)/u];var T=w(S,x);if(b(S,x)<=-1){T=Math.PI}if(b(S,x)>=1){T=0}if(s===0&&T>0){T=T-2*Math.PI}if(s===1&&T<0){T=T+2*Math.PI}return[m,g,o,u,E,T,f,s]};Kinetic.Factory.addGetterSetter(Kinetic.Path,"data");Kinetic.Collection.mapMethods(Kinetic.Path)})();(function(){function n(e){e.fillText(this.partialText,0,0)}function r(e){e.strokeText(this.partialText,0,0)}var e="",t="normal";Kinetic.TextPath=function(e){this.___init(e)};Kinetic.TextPath.prototype={___init:function(e){var t=this;this.dummyCanvas=Kinetic.Util.createCanvasElement();this.dataArray=[];Kinetic.Shape.call(this,e);this._fillFunc=n;this._strokeFunc=r;this._fillFuncHit=n;this._strokeFuncHit=r;this.className="TextPath";this.dataArray=Kinetic.Path.parsePathData(this.attrs.data);this.on("dataChange.kinetic",function(){t.dataArray=Kinetic.Path.parsePathData(this.attrs.data)});this.on("textChange.kinetic textStroke.kinetic textStrokeWidth.kinetic",t._setTextData);t._setTextData();this.sceneFunc(this._sceneFunc)},_sceneFunc:function(e){e.setAttr("font",this._getContextFont());e.setAttr("textBaseline","middle");e.setAttr("textAlign","left");e.save();var t=this.glyphInfo;for(var n=0;n<t.length;n++){e.save();var r=t[n].p0;e.translate(r.x,r.y);e.rotate(t[n].rotation);this.partialText=t[n].text;e.fillStrokeShape(this);e.restore()}e.restore()},getTextWidth:function(){return this.textWidth},getTextHeight:function(){return this.textHeight},setText:function(e){Kinetic.Text.prototype.setText.call(this,e)},_getTextSize:function(e){var t=this.dummyCanvas;var n=t.getContext("2d");n.save();n.font=this._getContextFont();var r=n.measureText(e);n.restore();return{width:r.width,height:parseInt(this.attrs.fontSize,10)}},_setTextData:function(){var e=this;var t=this._getTextSize(this.attrs.text);this.textWidth=t.width;this.textHeight=t.height;this.glyphInfo=[];var n=this.attrs.text.split("");var r,i,s;var o=-1;var u=0;var a=function(){u=0;var t=e.dataArray;for(var n=o+1;n<t.length;n++){if(t[n].pathLength>0){o=n;return t[n]}else if(t[n].command=="M"){r={x:t[n].points[0],y:t[n].points[1]}}}return{}};var f=function(t){var n=e._getTextSize(t).width;var o=0;var f=0;i=undefined;while(Math.abs(n-o)/n>.01&&f<25){f++;var l=o;while(s===undefined){s=a();if(s&&l+s.pathLength<n){l+=s.pathLength;s=undefined}}if(s==={}||r===undefined){return undefined}var c=false;switch(s.command){case"L":if(Kinetic.Path.getLineLength(r.x,r.y,s.points[0],s.points[1])>n){i=Kinetic.Path.getPointOnLine(n,r.x,r.y,s.points[0],s.points[1],r.x,r.y)}else{s=undefined}break;case"A":var h=s.points[4];var p=s.points[5];var d=s.points[4]+p;if(u===0){u=h+1e-8}else if(n>o){u+=Math.PI/180*p/Math.abs(p)}else{u-=Math.PI/360*p/Math.abs(p)}if(p<0&&u<d||p>=0&&u>d){u=d;c=true}i=Kinetic.Path.getPointOnEllipticalArc(s.points[0],s.points[1],s.points[2],s.points[3],u,s.points[6]);break;case"C":if(u===0){if(n>s.pathLength){u=1e-8}else{u=n/s.pathLength}}else if(n>o){u+=(n-o)/s.pathLength}else{u-=(o-n)/s.pathLength}if(u>1){u=1;c=true}i=Kinetic.Path.getPointOnCubicBezier(u,s.start.x,s.start.y,s.points[0],s.points[1],s.points[2],s.points[3],s.points[4],s.points[5]);break;case"Q":if(u===0){u=n/s.pathLength}else if(n>o){u+=(n-o)/s.pathLength}else{u-=(o-n)/s.pathLength}if(u>1){u=1;c=true}i=Kinetic.Path.getPointOnQuadraticBezier(u,s.start.x,s.start.y,s.points[0],s.points[1],s.points[2],s.points[3]);break}if(i!==undefined){o=Kinetic.Path.getLineLength(r.x,r.y,i.x,i.y)}if(c){c=false;s=undefined}}};for(var l=0;l<n.length;l++){f(n[l]);if(r===undefined||i===undefined){break}var c=Kinetic.Path.getLineLength(r.x,r.y,i.x,i.y);var h=0;var p=Kinetic.Path.getPointOnLine(h+c/2,r.x,r.y,i.x,i.y);var d=Math.atan2(i.y-r.y,i.x-r.x);this.glyphInfo.push({transposeX:p.x,transposeY:p.y,text:n[l],rotation:d,p0:r,p1:i});r=i}}};Kinetic.TextPath.prototype._getContextFont=Kinetic.Text.prototype._getContextFont;Kinetic.Util.extend(Kinetic.TextPath,Kinetic.Shape);Kinetic.Factory.addGetterSetter(Kinetic.TextPath,"fontFamily","Arial");Kinetic.Factory.addGetterSetter(Kinetic.TextPath,"fontSize",12);Kinetic.Factory.addGetterSetter(Kinetic.TextPath,"fontStyle",t);Kinetic.Factory.addGetterSetter(Kinetic.TextPath,"fontVariant",t);Kinetic.Factory.addGetter(Kinetic.TextPath,"text",e);Kinetic.Collection.mapMethods(Kinetic.TextPath)})();(function(){Kinetic.RegularPolygon=function(e){this.___init(e)};Kinetic.RegularPolygon.prototype={___init:function(e){Kinetic.Shape.call(this,e);this.className="RegularPolygon";this.sceneFunc(this._sceneFunc)},_sceneFunc:function(e){var t=this.attrs.sides,n=this.attrs.radius,r,i,s;e.beginPath();e.moveTo(0,0-n);for(r=1;r<t;r++){i=n*Math.sin(r*2*Math.PI/t);s=-1*n*Math.cos(r*2*Math.PI/t);e.lineTo(i,s)}e.closePath();e.fillStrokeShape(this)}};Kinetic.Util.extend(Kinetic.RegularPolygon,Kinetic.Shape);Kinetic.Factory.addGetterSetter(Kinetic.RegularPolygon,"radius",0);Kinetic.Factory.addGetterSetter(Kinetic.RegularPolygon,"sides",0);Kinetic.Collection.mapMethods(Kinetic.RegularPolygon)})();(function(){Kinetic.Star=function(e){this.___init(e)};Kinetic.Star.prototype={___init:function(e){Kinetic.Shape.call(this,e);this.className="Star";this.sceneFunc(this._sceneFunc)},_sceneFunc:function(e){var t=this.innerRadius(),n=this.outerRadius(),r=this.numPoints();e.beginPath();e.moveTo(0,0-n);for(var i=1;i<r*2;i++){var s=i%2===0?n:t;var o=s*Math.sin(i*Math.PI/r);var u=-1*s*Math.cos(i*Math.PI/r);e.lineTo(o,u)}e.closePath();e.fillStrokeShape(this)}};Kinetic.Util.extend(Kinetic.Star,Kinetic.Shape);Kinetic.Factory.addGetterSetter(Kinetic.Star,"numPoints",5);Kinetic.Factory.addGetterSetter(Kinetic.Star,"innerRadius",0);Kinetic.Factory.addGetterSetter(Kinetic.Star,"outerRadius",0);Kinetic.Collection.mapMethods(Kinetic.Star)})();(function(){var e=["fontFamily","fontSize","fontStyle","padding","lineHeight","text"],t="Change.kinetic",n="none",r="up",i="right",s="down",o="left",u="Label",a=e.length;Kinetic.Label=function(e){this.____init(e)};Kinetic.Label.prototype={____init:function(e){var t=this;this.className=u;Kinetic.Group.call(this,e);this.on("add.kinetic",function(e){t._addListeners(e.child);t._sync()})},getText:function(){return this.find("Text")[0]},getTag:function(){return this.find("Tag")[0]},_addListeners:function(n){var r=this,i;var s=function(){r._sync()};for(i=0;i<a;i++){n.on(e[i]+t,s)}},getWidth:function(){return this.getText().getWidth()},getHeight:function(){return this.getText().getHeight()},_sync:function(){var e=this.getText(),t=this.getTag(),n,u,a,f,l,c,h;if(e&&t){n=e.getWidth();u=e.getHeight();a=t.getPointerDirection();f=t.getPointerWidth();h=t.getPointerHeight();l=0;c=0;switch(a){case r:l=n/2;c=-1*h;break;case i:l=n+f;c=u/2;break;case s:l=n/2;c=u+h;break;case o:l=-1*f;c=u/2;break}t.setAttrs({x:-1*l,y:-1*c,width:n,height:u});e.setAttrs({x:-1*l,y:-1*c})}}};Kinetic.Util.extend(Kinetic.Label,Kinetic.Group);Kinetic.Collection.mapMethods(Kinetic.Label);Kinetic.Tag=function(e){this.___init(e)};Kinetic.Tag.prototype={___init:function(e){Kinetic.Shape.call(this,e);this.className="Tag";this.sceneFunc(this._sceneFunc)},_sceneFunc:function(e){var t=this.getWidth(),n=this.getHeight(),u=this.getPointerDirection(),a=this.getPointerWidth(),f=this.getPointerHeight();e.beginPath();e.moveTo(0,0);if(u===r){e.lineTo((t-a)/2,0);e.lineTo(t/2,-1*f);e.lineTo((t+a)/2,0)}e.lineTo(t,0);if(u===i){e.lineTo(t,(n-f)/2);e.lineTo(t+a,n/2);e.lineTo(t,(n+f)/2)}e.lineTo(t,n);if(u===s){e.lineTo((t+a)/2,n);e.lineTo(t/2,n+f);e.lineTo((t-a)/2,n)}e.lineTo(0,n);if(u===o){e.lineTo(0,(n+f)/2);e.lineTo(-1*a,n/2);e.lineTo(0,(n-f)/2)}e.closePath();e.fillStrokeShape(this)}};Kinetic.Util.extend(Kinetic.Tag,Kinetic.Shape);Kinetic.Factory.addGetterSetter(Kinetic.Tag,"pointerDirection",n);Kinetic.Factory.addGetterSetter(Kinetic.Tag,"pointerWidth",0);Kinetic.Factory.addGetterSetter(Kinetic.Tag,"pointerHeight",0);Kinetic.Factory.addGetterSetter(Kinetic.Tag,"cornerRadius",0);Kinetic.Collection.mapMethods(Kinetic.Tag)})()